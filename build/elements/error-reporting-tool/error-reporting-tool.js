/*
 * Original can be found at https://github.com/SanderRonde/CustomRightClickMenu 
 * This code may only be used under the MIT style license found in the LICENSE.txt file 
**/
"use strict";var errorReportingTool={reportType:"bug",image:"",hide:{type:Boolean,value:!0,notify:!0}},ERT=function(){function a(){}return a.toggleVisibility=function(){this.hide=!this.hide},a.isBugType=function(a){return"bug"===a},a.isEmptyImage=function(a){return""===a},a.scaleScreenshot=function(a,b,c){this.image=a.toDataURL();var d=window.innerHeight-450;d>750&&(d=750),750/b.width*b.height>d&&$(".captureCont").css("width",d/b.height*b.width),c&&c()},a.cropScreenshot=function(a,b,c){var d=this,e=new Image,f=d.$.cropCanvas,g=f.getContext("2d");e.onload=function(){g.clearRect(0,0,f.width,f.height),f.setAttribute("height",b.height+""),f.setAttribute("width",b.width+""),f.style.display="none",d.appendChild(f),g.drawImage(e,b.left,b.top,b.width,b.height,0,0,b.width,b.height);var a=f.toDataURL(),h=new Image;h.onload=function(){d.scaleScreenshot(f,h,c)},h.src=a;var i=document.createElement("img");i.src=a,document.body.appendChild(i)},e.src=a;var h=document.createElement("img");h.src=a,document.body.appendChild(h)},a.screenshot=function(a,b){var c=this;this.$.overlay.style.display="none",chrome.tabs.captureVisibleTab({format:"png"},function(d){c.$.overlay.style.display="block",c.cropScreenshot(d,a,b)})},a.px=function(a){return a+"px"},a.translateX=function(a,b){a.xPos=b,a.style.transform="translate("+b+","+(a.yPos||"0px")+")"},a.translateY=function(a,b){a.yPos=b,a.style.transform="translate("+(a.xPos||"0px")+","+b+")"},a.getDivs=function(a){var b=[this.$.highlightingLeftSquare,this.$.highlightingRightSquare],c=[this.$.highlightingTopSquare,this.$.highlightingBotSquare];switch(a){case"x":return b;case"y":return c;case"xy":return b.concat(c)}},a.setDivsXValues=function(a,b,c){var d=this.getDivs("x"),e=d[0],f=d[1];e.style.width=a,f.style.width="calc(100vw - ("+b+"))",this.translateX(f,c)},a.setSelectionX=function(a,b,c){if(this.lastPos.X!==c)if(b<0){var d=a+b;this.setDivsXValues(this.px(d),this.px(a),this.px(d-b))}else{var e=this.px(a+b);this.setDivsXValues(this.px(a),e,e)}},a.setDivsYValues=function(a){var b=a.topHeight,c=a.botTranslate,d=a.heights,e=a.botHeight,f=a.divsOffsetY,g=this.getDivs("xy"),h=g[0],i=g[1],j=g[2],k=g[3];j.style.height=b,h.style.height=i.style.height=d+"px",k.style.height="calc(100vh - ("+e+"))",this.translateY(k,c),this.translateY(h,f),this.translateY(i,f)},a.setSelectionY=function(a,b,c){if(this.lastPos.Y!==c)if(b<0){var d=this.px(a+b);this.setDivsYValues({topHeight:d,botTranslate:this.px(a),heights:this.px(-b),botHeight:this.px(a),divsOffsetY:d})}else{var e=a+b+"px";this.setDivsYValues({topHeight:this.px(a),botTranslate:e,heights:this.px(b),botHeight:e,divsOffsetY:this.px(a)})}},a.handleSelection=function(a){switch(a.detail.state){case"start":this.$.highlightButtons.classList.add("hidden");var b=a.detail.y+"px";this.lastSize.X=this.lastSize.Y=0,this.dragStart.X=this.lastPos.X=a.detail.x,this.dragStart.Y=this.lastPos.Y=a.detail.y,this.$.highlightingTopSquare.style.width="100vw",this.$.highlightingTopSquare.style.height=b,this.$.highlightingLeftSquare.style.width=b,this.translateY(this.$.highlightingBotSquare,b),this.translateY(this.$.highlightingLeftSquare,b),this.translateY(this.$.highlightingRightSquare,b);break;case"end":this.$.highlightButtons.classList.remove("hidden");break;case"track":if(a.detail.x!==this.lastPos.X||a.detail.y!==this.lastPos.Y){var c=a.detail.x-this.dragStart.X,d=a.detail.y-this.dragStart.Y;this.setSelectionX(this.dragStart.X,c,a.detail.x),this.setSelectionY(this.dragStart.Y,d,a.detail.y),this.lastSize.X=c,this.lastSize.Y=d,this.lastPos.X=a.detail.x,this.lastPos.Y=a.detail.y}}},a.resetSelection=function(){this.setSelectionX(0,0,0),this.setSelectionY(0,0,0)},a.toggleScreenCapArea=function(a){this.$.highlightingTopSquare.style.height="100vh",this.$.highlightingTopSquare.style.width="100vw",this.resetSelection(),this.$.overlay.classList[a?"add":"remove"]("toggled"),this.$.overlay.style.pointerEvents=a?"initial":"none"},a.cancelScreencap=function(){this.toggleScreenCapArea(!1),this.$.errorReportingDialog.open()},a.finishScreencap=function(){var a=this;this.toggleScreenCapArea(!1),this.screenshot({top:this.dragStart.Y,left:this.dragStart.X,height:this.lastSize.Y,width:this.lastSize.X},function(){a.$.errorReportingDialog.open()})},a.addCapture=function(){var a=this;a.$.errorReportingDialog.close(),this.toggleScreenCapArea(!0)},a.reportBug=function(){this.reportType="bug",this.image="",this.$.errorReportingDialog.open()},a.getStorages=function(a){chrome.storage.local.get(function(b){chrome.storage.sync.get(function(c){a(b,c)})})},a.downloadFiles=function(a){var b=this;chrome.downloads.download({url:this.image,filename:"screencap.png"},function(){"bug"===b.reportType?b.getStorages(function(c,d){var e={local:c,sync:d,lastError:b.lastError};chrome.downloads.download({url:"data:text/plain;base64,"+window.btoa(JSON.stringify(e)),filename:"settings.txt"},a)}):a()})},a.hideCheckmark=function(){var a=this;this.$.bugCheckmarkCont.classList.remove("checkmark"),this.async(function(){a.$.reportingButtonElevation.classList.remove("checkmark"),a.$.bugButton.classList.remove("checkmark"),a.$.bugCheckmark.classList.remove("checked")},350)},a.checkCheckmark=function(){var a=this;this.$.bugButton.classList.add("checkmark"),this.async(function(){a.$.reportingButtonElevation.classList.add("checkmark"),a.$.bugCheckmarkCont.classList.add("checkmark"),a.async(function(){a.$.bugCheckmark.classList.add("checked"),a.async(a.hideCheckmark,5e3)},350)},350)},a.getDownloadPermission=function(a){var b=this;chrome.permissions.request({permissions:["downloads"]},function(c){if(c){a(),window.errorReportingTool.$.errorReportingDialog.close();var d=function(){b.checkCheckmark(),window.removeEventListener("focus",d)};window.addEventListener("focus",d)}else window.doc.acceptDownloadToast.show()})},a.submitErrorReport=function(){var a=this;this.getDownloadPermission(function(){a.downloadFiles(function(){var b="WRITE MESSAGE HERE\n",c=("bug"===a.reportType?"Bug: ":"Feature: ")+"TITLE HERE";window.open("https://github.com/SanderRonde/CustomRightClickMenu/issues/new?title="+c+"&body="+b,"_blank")})})},a.onError=function(a,b,c,d,e){this.lastError={message:a,source:b,lineno:c,colno:d,error:e}},a.ready=function(){window.errorReportingTool=this,window.onerror=this.onError},a}();ERT.is="error-reporting-tool",ERT.properties=errorReportingTool,Polymer(ERT);