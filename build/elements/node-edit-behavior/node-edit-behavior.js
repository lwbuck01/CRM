/*
 * Original can be found at https://github.com/SanderRonde/CustomRightClickMenu 
 * This code may only be used under the MIT style license found in the LICENSE.txt file 
**/
"use strict";var nodeEditBehaviorProperties={newSettings:{type:Object,notify:!0,value:{}},pageContentSelected:{type:Boolean,notify:!0},linkContentSelected:{type:Boolean,notify:!0},selectionContentSelected:{type:Boolean,notify:!0},imageContentSelected:{type:Boolean,notify:!0},videoContentSelected:{type:Boolean,notify:!0},audioContentSelected:{type:Boolean,notify:!0}},NEB=function(){function a(){}return a.getContentTypeLaunchers=function(a){var b=this,c=["pageContentSelected","linkContentSelected","selectionContentSelected","imageContentSelected","videoContentSelected","audioContentSelected"];a.onContentTypes=c.map(function(a){return b[a]})},a.getTriggers=function(a){for(var b=$(this).find(".executionTrigger").find("paper-input"),c=[],d=0;d<b.length;d++)c[d]={url:b[d].querySelector("input").value,not:b[d].parentElement.children[0].checked};a.triggers=c},a.cancel=function(){Array.prototype.slice.apply(document.querySelectorAll("CodeMirror-Tern-tooltip")).forEach(function(a){a.remove()}),this.cancelChanges&&this.cancelChanges(),window.crmEditPage.animateOut()},a.save=function(a,b){var c=!1;null!==b&&void 0!==b&&"number"!=typeof b.x||(b=this.item,c=!0);var d=this.newSettings;this.saveChanges&&this.saveChanges(d),Array.prototype.slice.apply(document.querySelectorAll("CodeMirror-Tern-tooltip")).forEach(function(a){a.remove()}),this.getContentTypeLaunchers(d),this.getTriggers(d),window.crmEditPage.animateOut();var e=window.app.editCRM.getCRMElementFromPath(this.item.path,!1);d.name=this.$.nameInput.value,e.itemName=d.name,d.onContentTypes[window.app.crmType]||window.app.editCRM.build(window.app.editCRM.setMenus),d.value&&"link"!==d.type&&(void 0!==d.value.launchMode&&0!==d.value.launchMode?d.onContentTypes=[!0,!0,!0,!0,!0,!0]:d.onContentTypes[window.app.crmType]||window.app.editCRM.build(window.app.editCRM.setMenus)),window.app.templates.mergeObjectsWithoutAssignment(b,d),c&&window.app.upload()},a.inputKeyPress=function(a){27===a.keyCode&&this.cancel(),13===a.keyCode&&this.save()},a.assignContentTypeSelectedValues=function(){var a,b=["pageContentSelected","linkContentSelected","selectionContentSelected","imageContentSelected","videoContentSelected","audioContentSelected"];for(a=0;a<6;a++)this[b[a]]=this.item.onContentTypes[a]},a.checkToggledIconAmount=function(a){var b,c=0,d=["pageContentSelected","linkContentSelected","selectionContentSelected","imageContentSelected","videoContentSelected","audioContentSelected"];for(b=0;b<6;b++)if(this[d[b]]){if(1===c)return!0;c++}if(!c){var e=window.app.util.findElementWithTagname(a.path,"paper-checkbox");e.checked=!0,this[e.parentElement.classList[1].split("Type")[0]+"ContentSelected"]=!0,window.doc.contentTypeToast.show()}return!1},a.toggleIcon=function(a){if(!this.mode||"background"!==this.mode){var b=window.app.util.findElementWithClassName(a.path,"showOnContentItemCont"),c=$(b).find("paper-checkbox")[0];c.checked=!c.checked,c.checked||this.checkToggledIconAmount({path:[c]}),this.contentCheckboxChanged&&this.contentCheckboxChanged({path:[c]})}},a.clearTrigger=function(a){var b=a.target;"PAPER-ICON-BUTTON"===b.tagName&&(b=b.children[0]),this.splice("newSettings.triggers",Array.prototype.slice.apply(this.querySelectorAll(".executionTrigger")).indexOf(b.parentNode.parentNode),1)},a.addTrigger=function(){this.push("newSettings.triggers",{not:!1,url:"*://example.com/*"})},a._getPattern=function(){return Array.prototype.slice.apply(this.querySelectorAll(".triggerInput")).forEach(function(a){a.invalid=!1}),3!==this.newSettings.value.launchMode?"(/(.+)/)|.+":"(file:\\/\\/\\/.*|(\\*|http|https|file|ftp)://(\\*\\.[^/]+|\\*|([^/\\*]+.[^/\\*]+))(/(.*))?|(<all_urls>))"},a._getLabel=function(){return 2===this.newSettings.value.launchMode?"Globbing pattern or regex":"URL match pattern"},a.animateTriggers=function(a,b,c){b.style.height="auto",a.showTriggers?(b.style.display="block",b.style.marginLeft="-110%",b.style.height="0",$(b).animate({height:b.scrollHeight},300,function(){$(this).animate({marginLeft:0},200,function(){this.style.height="auto",c&&c()})})):(b.style.marginLeft="0",b.style.height=b.scrollHeight+"",$(b).animate({marginLeft:"-110%"},200,function(){$(this).animate({height:0},300,function(){b.style.display="none",c&&c()})})),this.showTriggers=a.showTriggers},a.animateContentTypeChooser=function(a,b,c){b.style.height="auto",a.showContentTypeChooser?(b.style.height="0",b.style.display="block",b.style.marginLeft="-110%",$(b).animate({height:b.scrollHeight},300,function(){$(this).animate({marginLeft:0},200,function(){this.style.height="auto",c&&c()})})):(b.style.marginLeft="0",b.style.height=b.scrollHeight+"",$(b).animate({marginLeft:"-110%"},200,function(){$(this).animate({height:0},300,function(){b.style.display="none",c&&c()})})),this.showContentTypeChooser=a.showContentTypeChooser},a.selectorStateChange=function(a,b){var c=this,d={showContentTypeChooser:0===b||3===b,showTriggers:b>1&&4!==b,showInsteadOfExecute:3===b},e={showContentTypeChooser:0===a||3===a,showTriggers:a>1&&4!==a,showInsteadOfExecute:3===a},f=this.$.executionTriggersContainer;e.showTriggers&&!d.showTriggers?e.showContentTypeChooser!==d.showContentTypeChooser?this.animateTriggers(d,f,function(){c.animateContentTypeChooser(d,f)}):this.animateTriggers(d,f):!e.showTriggers&&d.showTriggers?e.showContentTypeChooser!==d.showContentTypeChooser?this.animateContentTypeChooser(d,f,function(){c.animateTriggers(d,f)}):this.animateTriggers(d,f):e.showContentTypeChooser!==d.showContentTypeChooser&&this.animateContentTypeChooser(d,f),d.showInsteadOfExecute!==e.showInsteadOfExecute&&(this.$.showOrExecutetxt.innerText=d.showInsteadOfExecute?"Show":"Execute")},a.initDropdown=function(){this.showTriggers=this.item.value.launchMode>1&&4!==this.item.value.launchMode,this.showContentTypeChooser=0===this.item.value.launchMode||3===this.item.value.launchMode,this.showTriggers?(this.$.executionTriggersContainer.style.display="block",this.$.executionTriggersContainer.style.marginLeft="0",this.$.executionTriggersContainer.style.height="auto"):(this.$.executionTriggersContainer.style.display="none",this.$.executionTriggersContainer.style.marginLeft="-110%",this.$.executionTriggersContainer.style.height="0"),this.showContentTypeChooser?(this.$.showOnContentContainer.style.display="block",this.$.showOnContentContainer.style.marginLeft="0",this.$.showOnContentContainer.style.height="auto"):(this.$.showOnContentContainer.style.display="none",this.$.showOnContentContainer.style.marginLeft="-110%",this.$.showOnContentContainer.style.height="0"),this.$.dropdownMenu._addListener(this.selectorStateChange,"dropdownMenu",this),this.editor&&(this.editor.display.wrapper.remove(),this.editor=null)},a._init=function(){var a=this;this.newSettings=JSON.parse(JSON.stringify(this.item)),window.crmEditPage.nodeInfo=this.newSettings.nodeInfo,this.assignContentTypeSelectedValues(),setTimeout(function(){a.$.nameInput.focus()},350)},a}();NEB.properties=nodeEditBehaviorProperties,Polymer.NodeEditBehavior=NEB;