/*
 * Original can be found at https://github.com/SanderRonde/CustomRightClickMenu 
 * This code may only be used under the MIT style license found in the LICENSE.txt file 
**/
"use strict";!function(){function a(a,b){var c,d=!1;a.index++;for(var e=[];a.index<a.str.length&&(c=a.str[a.index]);a.index++){if(a.pos===a.index&&(a.cursor={type:"unknown",value:""+b+e.join(""),key:!1,scope:a.scope.slice(0)}),"\n"===c)return void a.errs.push({err:new Error("Unexpected end of string"),index:a.index,chars:1});if("\\"===c)d?(e.push(c),d=!1):d=!0;else{if(c===b)break;e.push(c)}}return""+b+e.join("")+b}function b(a){a.errs.push({err:new Error("Unexpected '"+a.str[a.index]+"', expected ','"),index:a.index,chars:1});var b=a.str.slice(a.index).indexOf(",");if(b===-1){var c=f(a.str,a.index);a.index=c-1}else a.index+=b}function c(a){a.errs.push({err:new Error("Unexpected '"+a.str[a.index]+"', expected ':'"),index:a.index,chars:1});var b=a.str.slice(a.index).indexOf(":");if(b===-1){var c=f(a.str,a.index);return a.index=c-1,"}"}var d=a.str.slice(a.index).indexOf(",");return d!==-1&&d<b?(a.index+=d+1,","):(a.index+=b+1,":")}function d(c,d){var e,f="none",g=!1,i=[],j=0;c.index++;for(var k=null,l=[];c.index<c.str.length&&(e=c.str[c.index]);c.index++)if("\n"!==e&&"\t"!==e&&" "!==e){if("\\eof"===c.str.slice(c.index,c.index+4)){c.errs.push({err:new Error("Missing '}'"),index:c.index-1,chars:1}),c.index-=1;break}if("{"===e){if("none"!==f){b(c);break}f="object",c.scope.push(d);var m=h(c.str,c.pos,c.index+1,c.scope,c.keyLines),n=m.options,o=m.cursor,p=m.newIndex,q=m.errs,r=m.keyLines;c.errs=c.errs.concat(q),c.keyLines=r,c.scope.pop(),c.cursor=c.cursor||o,c.index=p,i.length===j?i[j]=n:c.errs.push({err:new Error("Missing ','"),index:c.index,chars:1})}else if("["===e){if("none"!==f){b(c);break}f="array",g=!0}else if("]"===e)g=!1,"array"!==f&&c.errs.push({err:new Error("Unexpected ']', expected "+("none"!==f?"','":"value")),index:c.index,chars:1});else if(0===l.length&&'"'===e||"'"===e){if("none"!==f&&"array"!==f){b(c);break}"array"!==f&&(f="string");var s=a(c,e);if(void 0===s){b(c);break}i.length===j?i[j]=s:c.errs.push({err:new Error("Missing ','"),index:c.index,chars:1})}else if("-"===e){if("none"!==f&&"array"!==f){b(c);break}"array"!==f&&(f="number"),i[j]="-"}else if(/\d/.test(e)||"."===e){if("none"!==f&&"number"!==f&&"array"!==f){b(c);break}"array"!==f&&(f="number"),c.pos===c.index&&(c.cursor={type:"value",key:!1,scope:c.scope.slice(0),value:i.join("")}),i[j]=(i[j]||"")+e}else if("true"===c.str.slice(c.index,c.index+4)){if("none"!==f&&"array"!==f){b(c);break}"array"!==f&&(f="atom"),c.pos>=c.index&&c.pos<=c.index+4&&(c.cursor={type:"value",scope:c.scope.slice(0),key:!1,value:"true".slice(0,c.pos-c.index)}),c.index+=3,i.length===j?i[j]="true":c.errs.push({err:new Error("Missing ','"),index:c.index,chars:1})}else if("false"===c.str.slice(c.index,c.index+5)){if("none"!==f&&"array"!==f){b(c);break}"array"!==f&&(f="atom"),c.pos>=c.index&&c.pos<=c.index+5&&(c.cursor={type:"value",scope:c.scope.slice(0),key:!1,value:"false".slice(0,c.pos-c.index)}),c.index+=4,i.length===j?i[j]="false":c.errs.push({err:new Error("Missing ','"),index:c.index,chars:1})}else if("null"===c.str.slice(c.index,c.index+4)){if("none"!==f&&"array"!==f){b(c);break}"array"!==f&&(f="atom"),c.pos>=c.index&&c.pos<=c.index+4&&(c.cursor={type:"value",scope:c.scope.slice(0),key:!1,value:"null".slice(0,c.pos-c.index)}),c.index+=3,i.length===j?i[j]="null":c.errs.push({err:new Error("Missing ','"),index:c.index,chars:1})}else if("undefined"===c.str.slice(c.index,c.index+9)){if("none"!==f&&"array"!==f){b(c);break}"array"!==f&&(f="atom"),c.pos>=c.index&&c.pos<=c.index+9&&(c.cursor={type:"value",scope:c.scope.slice(0),key:!1,value:"undefined".slice(0,c.pos-c.index)}),c.index+=8,i.length===j?i[j]="null":c.errs.push({err:new Error("Missing ','"),index:c.index,chars:1})}else{if("}"===e){c.index-=1;break}if(","===e){if(c.pos===c.index){var t=void 0;switch(f){case"string":case"atom":case"object":case"number":t=i[0];break;case"array":t=i[j];break;case"unknown":t=l.join("")}c.cursor={type:"value",key:!1,scope:c.scope.slice(0),value:void 0===t?"":t}}if(!g){"none"===f&&c.errs.push({err:new Error("Unexpected ',', expected value"),index:c.index,chars:1});break}j+=1}else f="unknown",null===k&&(k=c.index),l.push(e),c.pos===c.index&&(c.cursor={type:"value",key:d,value:l,scope:c.scope.slice(0)})}}else if(c.pos===c.index){var t=void 0;switch(f){case"string":case"atom":case"object":case"number":t=i[0];break;case"array":t=i[j];break;case"unknown":t=l.join("")}c.cursor={type:"value",key:!1,scope:c.scope.slice(0),value:void 0===t?"":t}}switch(c.cursor&&"unknown"===c.cursor.type&&(c.cursor.type="value"),f){case"string":case"atom":case"object":case"number":return i[0];case"array":return i;case"unknown":return c.errs.push({err:new Error("Unknown value '"+l.join("")+"'"),index:k,chars:l.length}),void(c.cursor&&Array.isArray(c.cursor.value)&&(c.cursor.value=c.cursor.value.join("")))}}function e(e,f){for(var g,h=null,i=!1,j=null,k=[];e.index<e.str.length&&(g=e.str[e.index]);e.index++)if((e.pos===e.index||f)&&(f=!1,h?i&&(e.cursor={type:"value",key:h,value:"",scope:e.scope.slice(0)}):e.cursor={type:"key",key:k.join(""),scope:e.scope.slice(0)}),"\n"!==g&&"\t"!==g&&" "!==g){if("\\eof"===e.str.slice(e.index,e.index+4)){0!==e.errs.length&&/Missing '}'/.test(e.errs[e.errs.length-1].err.message)||e.errs.push({err:new Error("Missing '}'"),index:e.index-1,chars:1}),e.index-=1;break}if(h||i||'"'!==g&&"'"!==g)if(!h||i||'"'!==g&&"'"!==g)if(":"===g)i?e.errs.push({err:new Error("Unexpected ':', expected value"),index:e.index,chars:1}):h||k.length>0?i=!0:(e.errs.push({err:new Error("Unexpected ':', expected key"),index:e.index,chars:1}),i=!0);else{if(i){e.index-=1;var l=e.index,m=d(e,h);void 0!==m&&(e.keyLines[h]=e.keyLines[h]||[],e.keyLines[h].push({type:"value",index:l,scope:e.scope.slice(0),chars:e.index-l})),j=m;break}if(!i&&/\w|\d/.test(g))e.index===e.pos&&(e.cursor={type:"key",value:k.join(""),scope:e.scope.slice(0)}),0!==e.errs.length&&/Unexpected '(\w|\d)', expected '"'/.test(e.errs[e.errs.length-1].err.message)||e.errs.push({err:new Error("Unexpected '"+g+"', expected '\"'"),index:e.index,chars:1}),k.push(g);else if("}"===g){if(null===h&&i===!1&&null===j)return{key:void 0,value:void 0}}else{var n=c(e);if(":"!==n){if(","===n){j=void 0;break}h=void 0,j=void 0;break}i=!0}}else{var n=c(e);if(":"!==n){if(","===n){j=void 0;break}h=void 0,j=void 0;break}i=!0}else if(k.length>0)k.push(g);else{var l=e.index,m=a(e,g);if(e.cursor&&"unknown"===e.cursor.type&&(e.cursor.type="key",e.cursor.key=e.cursor.value,delete e.cursor.value),void 0===m){b(e),h=void 0;break}h=m,e.keyLines[m]=e.keyLines[m]||[],e.keyLines[m].push({type:"key",index:l,scope:e.scope.slice(0),chars:e.index-l+1})}}return e.cursor&&"value"===e.cursor.type&&e.cursor.key===!1&&(e.cursor.key=h),{key:void 0===h?void 0:h||'"'+k.join("")+'"',value:j}}function f(a,b){for(var c=!1,d=null,e=!1,f=0,g=b;g<a.length;g++)if(c||'"'!==a[g]&&"'"!==a[g])if(c&&a[g]===d)e?e=!1:(c=!1,d=null);else if("\\"===a[g])e=!e;else if("{"!==a[g]||c){if("}"!==a[g]||c)e&&(e=!1);else if(f--,f===-1)return g}else f++;else e?e=!1:(d=a[g],c=!0);return a.length-4}function g(a){var b={};return Object.getOwnPropertyNames(a).forEach(function(c){b['"'+c+'"']='"'+a[c]+'"'}),b}function h(a,b,c,d,h){if(void 0===c&&(c=1),void 0===d&&(d=[]),void 0===h&&(h={}),b!==-1&&(b<c||b>a.length))try{var i=a.slice(c-1,f(a,c));return{options:g(JSON.parse(i)),cursor:null,newIndex:c+i.length,errs:[],keyLines:{}}}catch(a){}for(var j,k={},l={cursor:null,errs:[],index:c,str:a,strLines:a.split("\n"),pos:b,scope:d,keyLines:h},m=!1;l.index<a.length&&(j=a[l.index]);l.index++)if("\n"!==j&&"\t"!==j){if("}"===j||"\\eof"===l.str.slice(l.index,l.index+4))break;var n=e(l,m),o=n.key,p=n.value;m=!1,void 0!==o&&void 0!==p&&(k[o]=p)}else l.pos===l.index&&(m=!0);return m&&(l.cursor={type:"key",key:"",scope:l.scope.slice(0)}),{options:k,cursor:l.cursor,newIndex:l.index,errs:l.errs,keyLines:l.keyLines}}function i(a){var b={};for(var c in a){var d=a[c];if(d)switch(d['"type"']){case'"string"':case'"boolean"':case'"choice"':case'"number"':b[c]=d['"type"'];break;case'"array"':b[c]='"string"'===d['"items"']?'"arrString"':'"number"'===d['"items"']?'"arrNumber"':'"array"';break;default:b[c]='"unknown"'}}return b}function j(a,b,c,d){var e=c[a].filter(function(a){return a.type===b&&(!(a.scope.length>0&&0===d)&&a.scope[0]===d)});return e.length>0?{errStart:e[0].index,errChars:e[0].chars}:{errStart:0,errChars:0}}function k(a,b){return x['"'+b+'"'].hasOwnProperty(a)}function l(a){if(Array.isArray(a))a=a.map(function(a){return JSON.parse(a)});else try{a=JSON.parse(a)}catch(b){a="'"===a[0]||"`"===a[0]?a.slice(1,-1):void 0}if("object"==typeof a&&Array.isArray(a)){for(var b=a.map(function(a){return"string"==typeof a?String:Number}),c=[],d=0;d<b.length;d++)c.indexOf(b[d])===-1&&c.push(b[d]);return 0===c.length?1:1===c.length?c[0]===String?2:3:4}switch(typeof a){case"boolean":return Boolean;case"number":return Number;case"string":return String;case null:return null;default:return}}function m(a,b){if(!Array.isArray(a)&&!Array.isArray(b))return 0===b||(!(1!==b&&4!==b||3!==a&&2!==a&&4!==a)||a===b);if(Array.isArray(a)){for(var c=0;c<a.length;c++)if(m(a[c],b))return!0;return!1}if(Array.isArray(b)){for(var c=0;c<b.length;c++)if(m(a,b[c]))return!0;return!1}return!1}function n(a,b){var c=l(a);return"string"==typeof a&&"string"==typeof b?a.slice(1,-1)===b:null===a&&null===b||m(c,b)}function o(a){if("string"==typeof a)return a;switch(a){case String:return"string";case Number:return"number";case Boolean:return"boolean";case 0:return"any";case 1:return"any[]";case 3:return"number[]";case 2:return"string[]";case 4:return"string/number[]"}return Array.isArray(a)?o(a[0]):"?"}function p(a){if("string"==typeof a)return"string";switch(a){case String:return"string";case Number:return"number";case Boolean:return"bool"}return Array.isArray(a)?"["+o(a[0])+"]":"?"}function q(a,b,c){var d=[],e=i(b);for(var f in b){var g=b[f];if(z.exec(f))if("object"!=typeof b[f]||Array.isArray(b[f])){var h=j(f,"key",c,0),l=h.errStart,m=h.errChars;d.push({err:new Error("Value of '"+f+"' is not an object"),index:l,chars:m})}else for(var p in g)if(z.exec(p))if(k(p,e[f].slice(1,-1))){var q=e[f];if(!n(g[p],x[q][p])){var r=j(p,"value",c,f),l=r.errStart,m=r.errChars;d.push({err:new Error("Value '"+g[p]+"' is not allowed for key '"+p+"', only values of type '"+o(x[q][p])+"' allowed"),index:l,chars:m})}}else{var s=j(p,"key",c,f),l=s.errStart,m=s.errChars;d.push({err:new Error("Key '"+p+"' is not allowed in type '"+e[f]+"'"),index:l,chars:m})}}return d}function r(a,b,c){switch(b.slice(1,-1)){case"number":if('"value"'===a&&void 0!==c['"minimum"']&&void 0!==c['"maximum"']){for(var d=[],e=0;e<10&&e+~~c['"minimum"']<~~c['"maximum"'];e++)d.push({name:e+"",doc:e+"",type:"number"});return d}return[];case"string":return[];case"choice":return'"selected"'===a&&c['"values"']?c['"values"'].map(function(a){return{name:a+"",doc:a+"",type:typeof a}}):[];case"boolean":return'"value"'===a?[{doc:"true",name:"true",type:"bool"},{doc:"false",name:"false",type:"bool"}]:[];case"arrNumber":case"arrString":return"items"===a?[{doc:"An array of strings",name:"string",type:"string"},{doc:"An array of numbes",name:"number",type:"string"}]:[];case"unknown":default:return"type"===a?[{doc:"An input for a number",name:"number",type:"string"},{doc:"An input for a string",name:"string",type:"string"},{doc:"An input allowing you to choose one of the given values",name:"choice",type:"string"},{doc:"A checkbox allowing you to choose true or false",name:"boolean",type:"string"},{doc:"A list that allows multiple inputs",name:"array",type:"string"}]:[]}}function s(a,b){if(!b)return[];if(1!==b.scope.length)return[];var c=a[b.scope[0]],d=i(a)[b.scope[0]],e=Object.getOwnPropertyNames(x[d]);if("key"===b.type){for(var f in c)e.splice(e.indexOf(f),1);return e.filter(function(a){return 0===a.indexOf(b.key)||0===a.indexOf('"'+b.key+'"')}).map(function(a){return{name:a,doc:y[b.key],type:p(x[d][b.key])}})}if(!z.exec(b.key))return[];if(e.indexOf(b.key)===-1)return[];var g=r(b.key,d,c);return g.filter(function(a){return 0===a.name.indexOf(b.value)})}function t(a,b){for(var c=0,d=0;d<a.length;d++){if(c+a[d].length>=b)return window.CodeMirror.Pos(d,b-c);c+=a[d].length+1}return window.CodeMirror.Pos(a.length,0)}function u(a,b){var c=[];return c[b]=void 0,c.join(a)}function v(a,b){for(var c,d=0;void 0!==(c=b.map(function(b){return a.indexOf(b)}).filter(function(a){return a!==-1})[0]);)a=a.slice(0,c)+a.slice(c+1),d++;return d}function w(a,b,c,d,e){var f,g,h,i=d>30,j=Math.min(d,30),k=i?10:Math.ceil((40-j)/2),l=0;f=b-c.ch+Math.max(c.ch-k,0),g=f+Math.min(c.ch,k),h=g+j,l=i?h:h+k;var m=a.slice(f,g),n=a.slice(g,h),o=a.slice(h,l),p=v(m,["\t","\n"]),q=v(n,["\t","\n"]);return""+(m+n+o).replace(/(\n|\t)/g,"")+(i?" ...":"")+"\n"+u("-",Math.min(c.ch,k)-p)+u("^",j-q)+"\n"+e}if(!window.completionsOptions){window.parseCodeOptions=function(a,b,c){var d=c.resolvePos(a,b.end),e=h(a.text+"\\eof",d);return a.text.length-1>e.newIndex&&(/^(\n|\t|\s)*$/.test(a.text.slice(e.newIndex))||e.errs.push({err:new Error("Expected eof"),index:e.newIndex+1,chars:1})),e};var x={'"number"':{'"type"':"number",'"minimum"':Number,'"maximum"':Number,'"descr"':String,'"value"':[Number,null]},'"string"':{'"type"':"string",'"maxLength"':Number,'"format"':String,'"descr"':String,'"value"':[String,null]},'"choice"':{'"type"':"choice",'"descr"':String,'"selected"':Number,'"values"':[4,null]},'"boolean"':{'"type"':"boolean",'"descr"':String,'"value"':[Boolean,null]},'"array"':{'"type"':"array",'"maxItems"':Number,'"descr"':String,'"items"':String},'"arrString"':{'"type"':"array",'"maxItems"':Number,'"descr"':String,'"items"':"string",'"value"':[2,null]},'"arrNumber"':{'"type"':"array",'"maxItems"':Number,'"descr"':String,'"items"':"number",'"value"':[3,null]},'"unknown"':{'"type"':String,'"descr"':String}},y={'"type"':"The type of the option",'"minimum"':"The minimum value of the number",'"maximum"':"The maximum value of the number",'"descr"':"The description of this option",'"value"':"The value of this option",'"maxLength"':"The maximum length of the string",'"format"':"A regex string the value has to match",'"selected"':"The selected option",'"values"':"The possible values",'"maxItems"':"The maximum number of values",'"items"':"The array of values"},z=/^"(\w+)"$/,A={start:{line:-1,ch:0},end:{line:-1,ch:0}},B={resolvePos:function(){return-1}};window.app.util.waitFor(window,"CodeMirror",function(a){window.CodeMirror.lint.optionsJSON=function(a,b,c){if(!window.useOptionsCompletions)return"javascript"===c.getOption("mode")?window.CodeMirror.lint.javascript(a,b,c):window.CodeMirror.lint.css(a,b,c);for(var d=window.parseCodeOptions({text:a},A,B),e=d.options,f=d.errs,g=d.keyLines,h=q(a,e,g),i=f.map(function(a){return{severity:"error",index:a.index,chars:a.chars,err:a.err}}).concat(h.map(function(a){return{severity:"warning",index:a.index,chars:a.chars,err:a.err}})),j=[],k=a.split("\n"),l=0;l<i.length;l++){var m=t(k,i[l].index),n=t(k,i[l].index+i[l].chars);j.push({from:m,to:n,severity:i[l].severity,message:w(a,i[l].index,m,i[l].chars,i[l].err.message)})}return j}}),window.completionsOptions=function(a,b,c){var d,e=window.parseCodeOptions(b,a,c),f=e.options,g=e.cursor;try{d=s(f,g)}catch(a){d=[]}return{completions:d,start:a.start||a.end,end:a.end,isObjectKey:g&&"key"===g.type,isProperty:g&&"value"===g.type}}}}();