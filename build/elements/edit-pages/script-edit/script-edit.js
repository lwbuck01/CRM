/*
 * Original can be found at https://github.com/SanderRonde/CustomRightClickMenu 
 * This code may only be used under the MIT style license found in the LICENSE.txt file 
**/
"use strict";var scriptEditProperties={item:{type:Object,value:{},notify:!0}},SCE=function(){function a(){}return a.openDocs=function(){window.open(chrome.runtime.getURL("/html/crmAPIDocs.html"),"_blank")},a.clearTriggerAndNotifyMetaTags=function(a){return 1===this.querySelectorAll(".executionTrigger").length?(window.doc.messageToast.text="You need to have at least one trigger",void window.doc.messageToast.show()):void this.clearTrigger(a)},a.triggerCheckboxChange=function(a){var b=!a.checked,c=$(a).parent().children(".triggerInput")[0].value,d=this.editor.removeMetaTags(this.editor,b?"exclude":"match",c);this.editor.addMetaTags(this.editor,b?"match":"exclude",c,d)},a.addTriggerAndAddListeners=function(){this.addTrigger()},a.contentCheckboxChanged=function(a){for(var b=window.app.util.findElementWithTagname(a.path,"paper-checkbox"),c=$("script-edit .showOnContentItemCheckbox"),d=b.classList[1].split("Type")[0],e=!b.checked,f=[],g=[],h=["page","link","selection","image","video","audio"],i=0;i<c.length;i++){var j=c[i];h[i]===d?(f[i]=e,g[i]=!e):(f[i]=j.checked,g[i]=j.checked)}},a.addDialogToMetaTagUpdateListeners=function(){var a=this,b=this;$(this.$.nameInput).on("keydown",function(){var b=a.$.nameInput,c=b.value||"";Array.isArray(c)&&(c=c[0])}),$(".executionTriggerNot").on("change",function(){b.triggerCheckboxChange.apply(b,[this])})},a.disableButtons=function(){this.$.dropdownMenu.disable()},a.enableButtons=function(){this.$.dropdownMenu.enable()},a.changeTab=function(a){if(a!==this.editorMode){"main"===a?("background"===this.editorMode&&(this.newSettings.value.backgroundScript=this.editor.getValue()),this.editorMode="main",this.enableButtons(),this.editor.setValue(this.newSettings.value.script)):"background"===a&&("main"===this.editorMode&&(this.newSettings.value.script=this.editor.getValue()),this.editorMode="background",this.disableButtons(),this.editor.setValue(this.newSettings.value.backgroundScript||""));var b=document.querySelector("main"===a?".mainEditorTab":".backgroundEditorTab");Array.prototype.slice.apply(document.querySelectorAll(".editorTab")).forEach(function(a){a.classList.remove("active")}),b.classList.add("active")}},a.switchBetweenScripts=function(a){if(a.classList.remove("optionsEditorTab"),"options"===this.editorMode)try{this.newSettings.value.options=JSON.parse(this.editor.getValue())}catch(a){this.newSettings.value.options=this.editor.getValue()}this.hideCodeOptions(),this.initTernKeyBindings()},a.changeTabEvent=function(a){var b=window.app.util.findElementWithClassName(a.path,"editorTab"),c=b.classList.contains("mainEditorTab"),d=b.classList.contains("backgroundEditorTab");c&&"main"!==this.editorMode?(this.switchBetweenScripts(b),this.changeTab("main")):!c&&d&&"background"!==this.editorMode?(this.switchBetweenScripts(b),this.changeTab("background")):d||"options"===this.editorMode||(b.classList.add("optionsEditorTab"),"main"===this.editorMode?this.newSettings.value.script=this.editor.getValue():"background"===this.editorMode&&(this.newSettings.value.backgroundScript=this.editor.getValue()),this.showCodeOptions(),this.editorMode="options"),Array.prototype.slice.apply(document.querySelectorAll(".editorTab")).forEach(function(a){a.classList.remove("active")}),b.classList.add("active")},a.getExportData=function(){$("script-edit #exportMenu paper-menu")[0].selected=0;var a={};return this.save(null,a),a},a.exportScriptAsCRM=function(){window.app.editCRM.exportSingleNode(this.getExportData(),"CRM")},a.exportScriptAsUserscript=function(){window.app.editCRM.exportSingleNode(this.getExportData(),"Userscript")},a.cancelChanges=function(){var a=this;this.fullscreen&&this.exitFullScreen(),window.setTimeout(function(){a.finishEditing(),window.externalEditor.cancelOpenFiles(),a.active=!1},this.fullscreen?500:0)},a.getMetaTagValues=function(){return this.editor.metaTags.metaTags},a.saveChanges=function(a){a.value.metaTags=this.getMetaTagValues(),this.finishEditing(),window.externalEditor.cancelOpenFiles(),this.changeTab("main"),this.active=!1},a.onPermissionsDialogOpen=function(a,b){var c,d;$(".requestPermissionsShowBot").off("click").on("click",function(){c=$(this).parent().parent().children(".requestPermissionsPermissionBotCont")[0],d=$(this).find(".requestPermissionsSvg")[0],d.style.transform="rotate(90deg)"===d.style.transform||""===d.style.transform?"rotate(270deg)":"rotate(90deg)",c.animation?c.animation.reverse():c.animation=c.animate([{height:0},{height:c.scrollHeight+"px"}],{duration:250,easing:"cubic-bezier(0.215, 0.610, 0.355, 1.000)",fill:"both"})});var e;$(".requestPermissionButton").off("click").on("click",function(){e=this.previousElementSibling.previousElementSibling.textContent;var c,d=this;this.checked?Array.prototype.slice.apply(a).indexOf(e)===-1?chrome.permissions.request({permissions:[e]},function(a){a?(chrome.storage.local.get(function(a){var b=a.requestPermissions;b.splice(b.indexOf(e),1),chrome.storage.local.set({requestPermissions:b})}),b.permissions=b.permissions||[],c=JSON.parse(JSON.stringify(b.permissions)),b.permissions.push(e)):d.checked=!1}):(b.permissions=b.permissions||[],c=JSON.parse(JSON.stringify(b.permissions)),b.permissions.push(e)):(c=JSON.parse(JSON.stringify(b.permissions)),b.permissions.splice(b.permissions.indexOf(e),1))})},a.openPermissionsDialog=function(a,b){var c,d,e=this;a&&"tap"!==a.type?(c=a,d=a):(c=this.item,d=this.newSettings),chrome.permissions.getAll(function(a){c.permissions||(c.permissions=[]);var f=c.permissions,g=window.app.templates.getScriptPermissions();a=a.permissions;var h,i,j,k=c.nodeInfo&&c.nodeInfo.permissions||[],l=[],m=[],n=[],o=[];g.forEach(function(a){h=k.indexOf(a)>-1,i=f.indexOf(a)>-1,j={name:a,toggled:i,required:h,description:window.app.templates.getPermissionDescription(a)},h&&i?l.push(j):h&&!i?m.push(j):!h&&i?n.push(j):o.push(j)});var p=n;p.push.apply(p,l),p.push.apply(p,m),p.push.apply(p,o),$("#scriptPermissionsTemplate")[0].items=p,$(".requestPermissionsScriptName")[0].innerHTML='Managing permisions for script "'+c.name;var q=$("#scriptPermissionDialog")[0];q.addEventListener("iron-overlay-opened",function(){e.onPermissionsDialogOpen(a,d)}),q.addEventListener("iron-overlay-closed",b),q.open()})},a.initToolsRibbon=function(){var a=this;window.app.$.paperLibrariesSelector.init(),window.app.$.paperGetPageProperties.init(function(b){a.insertSnippet(a,b)})},a.popInRibbons=function(){var a,b=window.app.$.editorCurrentScriptTitle;window.app.storageLocal.shrinkTitleRibbon?(window.doc.editorTitleRibbon.style.fontSize="40%",b.style.padding="0",a="-18px"):a="-51px",b.style.display="flex",b.style.marginTop=a;var c=[{marginTop:a},{marginTop:0}],d=window.app.storageLocal.hideToolsRibbon?"-200px":"0";b.style.marginLeft="-200px",c[0].marginLeft="-200px",c[1].marginLeft=0,this.initToolsRibbon(),setTimeout(function(){window.doc.editorToolsRibbonContainer.style.display="flex",window.doc.editorToolsRibbonContainer.animate([{marginLeft:"-200px"},{marginLeft:d}],{duration:500,easing:"cubic-bezier(0.215, 0.610, 0.355, 1.000)"}).onfinish=function(){window.doc.editorToolsRibbonContainer.style.marginLeft=d,window.doc.editorToolsRibbonContainer.classList.add("visible")}},200),setTimeout(function(){window.doc.dummy.style.height="0",$(window.doc.dummy).animate({height:"50px"},{duration:500,easing:$.bez([.215,.61,.355,1]),step:function(a){window.doc.fullscreenEditorHorizontal.style.height="calc(100vh - "+a+"px)"}}),b.animate(c,{duration:500,easing:"cubic-bezier(0.215, 0.610, 0.355, 1.000)"}).onfinish=function(){b.style.marginTop="0",void 0!==c[0].marginLeft&&(b.style.marginLeft="0")}},200)},a.popOutRibbons=function(){var a=window.app.$.editorCurrentScriptTitle,b=window.app.$.editorToolsRibbonContainer,c=!window.app.storageLocal.hideToolsRibbon&&b&&b.classList.contains("visible"),d=a.getBoundingClientRect().height>20,e=[{marginTop:0,marginLeft:0},{marginTop:d?"-51px":"-18px",marginLeft:c?"-200px":0}];c?(a.animate(e,{duration:800,easing:"cubic-bezier(0.215, 0.610, 0.355, 1.000)"}).onfinish=function(){a.style.marginTop=e[1].marginTop+"",a.style.marginLeft=e[1].marginLeft+""},b.animate([{marginLeft:0},{marginLeft:"-200px"}],{duration:800,easing:"cubic-bezier(0.215, 0.610, 0.355, 1.000)"}).onfinish=function(){a.style.display="none",b.style.display="none",b.style.marginLeft="-200px"}):(window.doc.dummy.style.height=d?"50px":"18px",$(window.doc.dummy).animate({height:0},{duration:800,easing:$.bez([.215,.61,.355,1]),step:function(a){window.doc.fullscreenEditorHorizontal.style.height="calc(100vh - "+a+"px)"}}),a.animate([{marginTop:0},{marginTop:d?"-51px":"-18px"}],{duration:800,easing:"cubic-bezier(0.215, 0.610, 0.355, 1.000)"}).onfinish=function(){a.style.display="none",b.style.display="none",a.style.marginTop=d?"-51px":"-18px"})},a.enterFullScreen=function(){var a=this;if(!this.fullscreen){this.fullscreen=!0;var b=this.editor.display.wrapper.getBoundingClientRect(),c=window.doc.fullscreenEditor,d=c.style;d.marginLeft=this.preFullscreenEditorDimensions.marginLeft=b.left+"px",d.marginTop=this.preFullscreenEditorDimensions.marginTop=b.top+"px",d.height=this.preFullscreenEditorDimensions.height=b.height+"px",d.width=this.preFullscreenEditorDimensions.width=b.width+"px",window.paperLibrariesSelector.updateLibraries("main"===this.editorMode?this.newSettings.value.libraries:this.newSettings.value.backgroundLibraries||[]),this.editorMode,this.fullscreenEl.children[0].innerHTML='<path d="M10 32h6v6h4V28H10v4zm6-16h-6v4h10V10h-4v6zm12 22h4v-6h6v-4H28v10zm4-22v-6h-4v10h10v-4h-6z"/>';var e=$(this.editor.display.wrapper),f=e.find("#buttonShadow")[0];f.style.position="absolute",f.style.right="-1px",this.editor.display.wrapper.classList.add("fullscreen"),this.editor.display.wrapper.classList.remove("small"),e.appendTo(window.doc.fullscreenEditorHorizontal);var g=$("#horizontalCenterer"),h=g.width()+20,i=g.height();void 0!==window.app.storageLocal.hideToolsRibbon?window.app.storageLocal.hideToolsRibbon?window.doc.showHideToolsRibbonButton.style.transform="rotate(0deg)":window.doc.showHideToolsRibbonButton.style.transform="rotate(180deg)":(chrome.storage.local.set({hideToolsRibbon:!1}),window.app.storageLocal.hideToolsRibbon=!1,window.doc.showHideToolsRibbonButton.style.transform="rotate(0deg)"),void 0!==window.app.storageLocal.shrinkTitleRibbon?window.app.storageLocal.shrinkTitleRibbon?window.doc.shrinkTitleRibbonButton.style.transform="rotate(90deg)":window.doc.shrinkTitleRibbonButton.style.transform="rotate(270deg)":(chrome.storage.local.set({shrinkTitleRibbon:!1}),window.app.storageLocal.shrinkTitleRibbon=!1,window.doc.shrinkTitleRibbonButton.style.transform="rotate(270deg)"),e[0].style.height="auto",document.documentElement.style.overflow="hidden",c.style.display="flex",$(c).animate({width:h,height:i,marginTop:0,marginLeft:0},{duration:500,easing:"easeOutCubic",complete:function(){a.editor.refresh(),a.style.width="100vw",a.style.height="100vh",f.style.position="fixed",window.app.$.fullscreenEditorHorizontal.style.height="100vh",a.popInRibbons()}})}},a.exitFullScreen=function(){if(this.fullscreen){this.fullscreen=!1;var a=this;this.popOutRibbons();var b=$(a.editor.display.wrapper),c=b.find("#buttonShadow");c[0].style.position="absolute",setTimeout(function(){a.editor.display.wrapper.classList.remove("fullscreen"),a.editor.display.wrapper.classList.add("small");var b=window.doc.fullscreenEditor;a.fullscreenEl.children[0].innerHTML='<svg xmlns="http://www.w3.org/2000/svg" width="48" height="48" viewBox="0 0 48 48"><path d="M14 28h-4v10h10v-4h-6v-6zm-4-8h4v-6h6v-4H10v10zm24 14h-6v4h10V28h-4v6zm-6-24v4h6v6h4V10H28z"/></svg>',$(b).animate({width:a.preFullscreenEditorDimensions.width,height:a.preFullscreenEditorDimensions.height,marginTop:a.preFullscreenEditorDimensions.marginTop,marginLeft:a.preFullscreenEditorDimensions.marginLeft},{duration:500,easing:"easeOutCubic",complete:function(){b.style.marginLeft="0",b.style.marginTop="0",b.style.width="0",b.style.height="0",$(a.editor.display.wrapper).appendTo(a.$.editorCont).css({height:a.preFullscreenEditorDimensions.height,marginTop:0,marginLeft:0})}})},800)}},a.showOptions=function(){var a=this;this.optionsShown=!0,this.unchangedEditorSettings=$.extend(!0,{},window.app.settings.editor);var b,c=$(".script-edit-codeMirror").width(),d=$(".script-edit-codeMirror").height();b=this.fullscreen?Math.sqrt(25e4+d*d)+100:Math.sqrt(c*c+d*d)+200;var e=-b;b=2*b,this.settingsShadow.parentElement.style.width=c+"",this.settingsShadow.parentElement.style.height=d+"",this.fullscreenEl.style.display="none";var f=-500;$("#editorThemeFontSizeInput")[0].value=window.app.settings.editor.zoom,$(this.settingsShadow).css({width:"50px",height:"50px",borderRadius:"50%",marginTop:"-25px",marginRight:"-25px"}).animate({width:b,height:b,marginTop:e,marginRight:e},{duration:500,easing:"linear",progress:function(b){a.editorOptions.style.marginLeft=f-b.tweens[3].now+"px",a.editorOptions.style.marginTop=-b.tweens[2].now+"px"},complete:function(){if(a.fullscreen){var b=$(".script-edit-codeMirror #settingsContainer")[0];b.style.overflow="scroll",b.style.overflowX="hidden",b.style.height="calc(100vh - 66px)";var c=$(".script-edit-codeMirror #bubbleCont")[0];c.style.position="fixed",c.style.zIndex="50"}}})},a.hideOptions=function(){var a=this;this.optionsShown=!1;var b=-500;this.fullscreenEl.style.display="block",$(this.settingsShadow).animate({width:0,height:0,marginTop:0,marginRight:0},{duration:500,easing:"linear",progress:function(c){a.editorOptions.style.marginLeft=b-c.tweens[3].now+"px",a.editorOptions.style.marginTop=-c.tweens[2].now+"px"},complete:function(){var b=window.app.settings.editor.zoom,c=a.unchangedEditorSettings.zoom;if(a.unchangedEditorSettings.zoom=b,JSON.stringify(a.unchangedEditorSettings)!==JSON.stringify(window.app.settings.editor)&&a.reloadEditor(),b!==c&&window.app.updateEditorZoom(),a.fullscreen){var d=$(".script-edit-codeMirror #settingsContainer")[0];d.style.height="345px",d.style.overflowX="hidden";var e=$(".script-edit-codeMirror #bubbleCont")[0];e.style.position="absolute",e.style.zIndex="auto"}}})},a.reloadEditor=function(a){if(void 0===a&&(a=!1),this.editor)if($(this.editor.display.wrapper).remove(),this.$.editorPlaceholder.style.display="flex",this.$.editorPlaceholder.style.opacity="1",this.$.editorPlaceholder.style.position="absolute","main"===this.editorMode)this.newSettings.value.script=this.editor.doc.getValue();else if("background"===this.editorMode)this.newSettings.value.backgroundScript=this.editor.doc.getValue();else try{this.newSettings.value.options=JSON.parse(this.editor.doc.getValue())}catch(a){this.newSettings.value.options=this.editor.doc.getValue()}this.editor=null;var b;b="main"===this.editorMode?this.newSettings.value.script:"background"===this.editorMode?this.newSettings.value.backgroundScript:"string"==typeof this.newSettings.value.options?this.newSettings.value.options:JSON.stringify(this.newSettings.value.options),this.fullscreen?this.loadEditor(window.doc.fullscreenEditorHorizontal,b,a):this.loadEditor(this.$.editorCont,b,a)},a.createKeyBindingListener=function(a,b){var c=this;return function(d){if(d.preventDefault(),(d.keyCode<16||d.keyCode>18)&&(d.altKey||d.shiftKey||d.ctrlKey)){var e=[];d.ctrlKey&&e.push("Ctrl"),d.altKey&&e.push("Alt"),d.shiftKey&&e.push("Shift"),e.push(String.fromCharCode(d.keyCode));var f=a.value=e.join("-");a.lastValue=f,window.app.settings.editor.keyBindings=window.app.settings.editor.keyBindings||{autocomplete:c.keyBindings[0].defaultKey,showType:c.keyBindings[0].defaultKey,showDocs:c.keyBindings[1].defaultKey,goToDef:c.keyBindings[2].defaultKey,jumpBack:c.keyBindings[3].defaultKey,rename:c.keyBindings[4].defaultKey,selectName:c.keyBindings[5].defaultKey};var g=window.app.settings.editor.keyBindings[b.storageKey];if(g){var h={};h[g]=b.fn,window.scriptEdit.editor.removeKeyMap(h)}var i={};i[f]=b.fn,window.scriptEdit.editor.addKeyMap(i),window.app.settings.editor.keyBindings[b.storageKey]=f}a.value=a.lastValue||""}},a.fillEditorOptions=function(a){function b(){setTimeout(function(){window.app.settings.editor.zoom=h.querySelector("input").value,window.app.upload()},0)}function c(){setTimeout(function(){window.app.settings.editor.tabSize=~~g.querySelector("#editorTabSizeInput paper-input-container input").value,window.app.upload()},0)}var d=document.querySelector("#editorOptionsTemplate").content;"white"===window.app.settings.editor.theme?d.querySelector("#editorThemeSettingWhite").classList.add("currentTheme"):d.querySelector("#editorThemeSettingWhite").classList.remove("currentTheme"),"dark"===window.app.settings.editor.theme?d.querySelector("#editorThemeSettingDark").classList.add("currentTheme"):d.querySelector("#editorThemeSettingDark").classList.remove("currentTheme"),d.querySelector("#editorTabSizeInput paper-input-container input").setAttribute("value",window.app.settings.editor.tabSize+"");var e=d.querySelector("#editorTabsOrSpacesCheckbox");window.app.settings.editor.useTabs?e.setAttribute("checked","checked"):e.removeAttribute("checked");var f=document.importNode(d,!0);a.appendChild(f);var g=a;g.querySelector("#editorThemeSettingWhite").addEventListener("click",function(){var a=g.querySelectorAll(".editorThemeSetting");a[0].classList.add("currentTheme"),a[1].classList.remove("currentTheme"),window.app.settings.editor.theme="white",window.app.upload()}),g.querySelector("#editorThemeSettingDark").addEventListener("click",function(){var a=g.querySelectorAll(".editorThemeSetting");a[0].classList.remove("currentTheme"),a[1].classList.add("currentTheme"),window.app.settings.editor.theme="dark",window.app.upload()});var h=g.querySelector("#editorThemeFontSizeInput");h.addEventListener("change",function(){b()}),this._updateZoomEl=b,g.querySelector("#editorTabsOrSpacesCheckbox").addEventListener("click",function(){window.app.settings.editor.useTabs=!window.app.settings.editor.useTabs,window.app.upload()}),g.querySelector("#editorTabSizeInput paper-input-container input").addEventListener("change",function(){c()}),this._updateTabSizeEl=c,g.querySelector("#editorJSLintGlobalsInput").addEventListener("keypress",function(){var a=this;setTimeout(function(){var b=a.value,c=b.split(",");chrome.storage.local.set({jsLintGlobals:c}),window.app.jsLintGlobals=c},0)}),window.app.settings.editor.keyBindings=window.app.settings.editor.keyBindings||{autocomplete:this.keyBindings[0].defaultKey,showType:this.keyBindings[0].defaultKey,showDocs:this.keyBindings[1].defaultKey,goToDef:this.keyBindings[2].defaultKey,jumpBack:this.keyBindings[3].defaultKey,rename:this.keyBindings[4].defaultKey,selectName:this.keyBindings[5].defaultKey};for(var i=g.querySelector("#settingsContainer"),j=0;j<this.keyBindings.length;j++){var k=document.querySelector("#keyBindingTemplate").content,l=k.querySelector("paper-input"),m=window.app.settings.editor.keyBindings[this.keyBindings[j].storageKey]||this.keyBindings[j].defaultKey;l.setAttribute("label",this.keyBindings[j].name),l.setAttribute("value",m);var n=document.importNode(k,!0);i.insertBefore(n,i.querySelector("#afterEditorSettingsSpacing")),i.querySelector("paper-input").addEventListener("keydown",this.createKeyBindingListener(l,this.keyBindings[j]))}},a.initTernKeyBindings=function(){for(var a={},b=0;b<this.keyBindings.length;b++)a[window.app.settings.editor.keyBindings[this.keyBindings[b].storageKey]]=this.keyBindings[b].fn;this.editor.setOption("extraKeys",a),this.editor.on("cursorActivity",function(a){window.app.ternServer.updateArgHints(a)})},a._posToIndex=function(a,b){for(var c=0,d=0;d<b.length;d++){if(!(d<a.line))return c+=a.ch;c+=b[d].length,c++}return c},a._indexToPos=function(a,b){for(var c=0,d=0;d<b.length;d++){if(c+=b[d].length,c>=a)return{line:d,ch:a-(c-b[d].length)};c++}return{line:0,ch:a}},a._posInRange=function(a,b,c){var d=this._posToIndex(b,a.lines),e=this._posToIndex(c,a.lines);return a.end>=d&&a.end<=e||a.start>=d&&a.start<=e||a.start<=d&&a.end>=e},a.findChromeBaseExpression=function(a,b){var c=this,d=this.editor.getValue(),e={name:"[doc]",text:d,type:"full"},f=d.split("\n"),g=f.pop();window.app.ternServer.server.request({query:{docs:!0,end:window.CodeMirror.Pos(f.length-1,g.length-1),file:"[doc]",lineCharPositions:!0,type:"type",types:!0,urls:!0},files:[e]},function(d){c.markers.forEach(function(a){return a.clear()});for(var e=!1,g=window.app.ternServer.server.files[0],h={lineSeperators:window.app.legacyScriptReplace.localStorageReplace.getLineSeperators(f),script:g.text,lines:f},i=0;i<g.ast.body.length;i++){var j=c._posInRange({lines:f,start:g.ast.body[i].start,end:g.ast.body[i].end},a,b);if(!e&&j)e=!0;else if(e&&!j)return;j&&window.app.legacyScriptReplace.localStorageReplace.findExpression(g.ast.body[i],h,"chrome",function(a,b){(a.isObj||"Identifier"===a.siblingExpr.type&&"window"===a.siblingExpr.name)&&c.markers.push(c.editor.doc.markText(c._indexToPos(b.start,f),c._indexToPos(b.end,f),{className:"chromeCallsDeprecated",inclusiveLeft:!1,inclusiveRight:!1,atomic:!1,clearOnEnter:!1,clearWhenEmpty:!0,readOnly:!1,title:'Direct chrome calls are deprecated, please use the CRM API for chrome calls (documentation can be found at the "docs" button)'}))})}})},a.cmLoaded=function(a){var b=this;this.editor=a,a.refresh(),a.on("metaTagChanged",function(a,c){"main"===b.editorMode&&(b.newSettings.value.metaTags=JSON.parse(JSON.stringify(c)))}),this.$.mainEditorTab.classList.add("active"),this.$.backgroundEditorTab.classList.remove("active"),a.on("metaDisplayStatusChanged",function(a){b.newSettings.value.metaTagsHidden="hidden"===a.status}),a.performLint();var c=[];a.on("changes",function(a,b){c=c.concat(b.map(function(a){return{from:a.from,to:a.to,removed:a.removed,text:a.text,origin:a.origin,time:Date.now()}}))});var d=window.setInterval(function(){b.active?c.length>0&&Date.now()-c.slice(-1)[0].time>1e3&&(a.performLint(),c.forEach(function(a){b.findChromeBaseExpression(a.from,a.to)}),c=[]):window.clearInterval(d)},1e3);this.newSettings.value.metaTagsHidden&&(a.doc.markText({line:a.metaTags.metaStart.line,ch:a.metaTags.metaStart.ch-2},{line:a.metaTags.metaStart.line,ch:a.metaTags.metaStart.ch+27},{className:"metaTagHiddenText",inclusiveLeft:!1,inclusiveRight:!1,atomic:!0,readOnly:!0,addToHistory:!0}),a.metaTags.metaTags=this.newSettings.value.metaTags),a.display.wrapper.classList.remove("stylesheet-edit-codeMirror"),a.display.wrapper.classList.add("script-edit-codeMirror"),a.display.wrapper.classList.add("small");var e=document.importNode(document.querySelector("#scriptEditorTemplate").content,!0);a.display.sizer.insertBefore(e,a.display.sizer.children[0]);var f=a.display.sizer;this.settingsShadow=f.querySelector("#settingsShadow"),this.editorOptions=f.querySelector("#editorOptions"),this.fillEditorOptions(this.editorOptions),this.fullscreenEl=f.querySelector("#editorFullScreen"),this.fullscreenEl.addEventListener("click",function(){b.toggleFullScreen.apply(b)}),this.settingsEl=f.querySelector("#editorSettings"),this.settingsEl.addEventListener("click",function(){b.toggleOptions.apply(b)}),"nocursor"===a.getOption("readOnly")&&(a.display.wrapper.style.backgroundColor="rgb(158, 158, 158)");var g=a.display.sizer.querySelector("#buttonShadow");this.fullscreen?(a.display.wrapper.style.height="auto",this.$.editorPlaceholder.style.display="none",g.style.right="-1px",g.style.position="absolute",this.fullscreenEl.children[0].innerHTML='<path d="M10 32h6v6h4V28H10v4zm6-16h-6v4h10V10h-4v6zm12 22h4v-6h6v-4H28v10zm4-22v-6h-4v10h10v-4h-6z"/>'):(this.$.editorPlaceholder.style.height=this.editorHeight+"px",this.$.editorPlaceholder.style.width=this.editorWidth+"px",this.$.editorPlaceholder.style.position="absolute",this.editorPlaceHolderAnimation?this.editorPlaceHolderAnimation.play():(this.editorPlaceHolderAnimation=this.$.editorPlaceholder.animate([{opacity:1},{opacity:0}],{duration:300,easing:"cubic-bezier(0.215, 0.610, 0.355, 1.000)"}),this.editorPlaceHolderAnimation.onfinish=function(){this.effect.target.style.display="none"})),this.initTernKeyBindings()},a.loadEditor=function(a,b,c){void 0===b&&(b=this.item.value.script),void 0===c&&(c=!1);var d=$(this.$.editorPlaceholder);this.editorHeight=d.height(),this.editorWidth=d.width(),!window.app.settings.editor&&(window.app.settings.editor={useTabs:!0,theme:"dark",zoom:"100",tabSize:4,keyBindings:{autocomplete:this.keyBindings[0].defaultKey,showType:this.keyBindings[0].defaultKey,showDocs:this.keyBindings[1].defaultKey,goToDef:this.keyBindings[2].defaultKey,jumpBack:this.keyBindings[3].defaultKey,rename:this.keyBindings[4].defaultKey,selectName:this.keyBindings[5].defaultKey}}),this.editor=window.CodeMirror(a,{lineNumbers:!0,value:b,scrollbarStyle:"simple",lineWrapping:!0,mode:"javascript",foldGutter:!0,readOnly:!!c&&"nocursor",theme:"dark"===window.app.settings.editor.theme?"dark":"default",indentUnit:window.app.settings.editor.tabSize,indentWithTabs:window.app.settings.editor.useTabs,messageScriptEdit:!0,gutters:["CodeMirror-lint-markers","CodeMirror-foldgutter"],lint:window.CodeMirror.lint.optionsJSON,undoDepth:500})},a.init=function(){var a=this;this._init(),this.$.dropdownMenu.init(),this.$.exportMenu.init(),this.$.exportMenu.querySelector("#dropdownSelected").innerHTML="EXPORT AS",this.initDropdown(),this.selectorStateChange(0,this.newSettings.value.launchMode),this.addDialogToMetaTagUpdateListeners(),window.app.ternServer=window.app.ternServer||new window.CodeMirror.TernServer({defs:[window.ecma5,window.ecma6,window.browserDefs,window.crmAPIDefs]}),document.body.classList.remove("editingStylesheet"),document.body.classList.add("editingScript"),window.scriptEdit=this,this.$.editorPlaceholder.style.display="flex",this.$.editorPlaceholder.style.opacity="1",window.externalEditor.init(),window.app.storageLocal.recoverUnsavedData&&(chrome.storage.local.set({editing:{val:this.item.value.script,id:this.item.id,mode:a.editorMode,crmType:window.app.crmType}}),this.savingInterval=window.setInterval(function(){if(a.active&&a.editor){var b=a.editor.getValue();chrome.storage.local.set({editing:{val:b,id:a.item.id,mode:a.editorMode,crmType:window.app.crmType}},function(){chrome.runtime.lastError})}else chrome.storage.local.set({editing:!1}),window.clearInterval(a.savingInterval)},5e3)),this.active=!0,setTimeout(function(){a.loadEditor(a.$.editorCont)},750)},a}();SCE.is="script-edit",SCE.behaviors=[Polymer.NodeEditBehavior,Polymer.CodeEditBehavior],SCE.properties=scriptEditProperties,SCE.markers=[],SCE.keyBindings=[{name:"AutoComplete",defaultKey:"Ctrl-Space",storageKey:"autocomplete",fn:function(a){window.app.ternServer.complete(a)}},{name:"Show Type",defaultKey:"Ctrl-I",storageKey:"showType",fn:function(a){window.app.ternServer.showType(a)}},{name:"Show Docs",defaultKey:"Ctrl-O",storageKey:"showDocs",fn:function(a){window.app.ternServer.showDocs(a)}},{name:"Go To Definition",defaultKey:"Alt-.",storageKey:"goToDef",fn:function(a){window.app.ternServer.jumpToDef(a)}},{name:"Jump Back",defaultKey:"Alt-,",storageKey:"jumpBack",fn:function(a){window.app.ternServer.jumpBack(a)}},{name:"Rename",defaultKey:"Ctrl-Q",storageKey:"rename",fn:function(a){window.app.ternServer.rename(a)}},{name:"Select Name",defaultKey:"Ctrl-.",storageKey:"selectName",fn:function(a){window.app.ternServer.selectName(a)}}],Polymer(SCE);