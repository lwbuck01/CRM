/*
 * Original can be found at https://github.com/SanderRonde/CustomRightClickMenu 
 * This code may only be used under the MIT style license found in the LICENSE.txt file 
**/
"use strict";var editCrmItemProperties={item:{type:Object,notify:!0},expanded:{type:Boolean,notify:!0},shadow:{type:Boolean,notify:!0},itemName:{type:String,notify:!0},isMenu:{type:Boolean,notify:!0},isCode:{type:Boolean,notify:!0}},ECI=function(){function a(){}return a._openCodeSettings=function(){window.app.initCodeOptions(this.item)},a.getMenuExpandMessage=function(){return"Click to show "+this.item.children.length+" child"+(this.item.children.length>1?"ren":"")},a.update=function(){if(!this.classList.contains("id"+this.item.id)){for(var a=this.classList,b=0;b<a.length;b++)if(a[b].indexOf("id")>-1){this.classList.remove(a[b]);break}this.ready()}},a.ready=function(){if(!this.classList.contains("draggingFiller")){var a=this;if(this.classList.add("id"+this.item.id),"wait"!==this.classList[0]&&(this.itemIndex=this.index,this.item=this.item,this.itemName=this.item.name,this.calculateType(),this.itemIndex=this.index,this.$.typeSwitcher&&this.$.typeSwitcher.ready&&this.$.typeSwitcher.ready(),window.app.editCRM.isSelecting&&(this.classList.add("selecting"),window.app.editCRM.selectedElements.indexOf(this.item.id)>-1?this.onSelect(!0,!0):this.onDeselect(!0,!0))),~~/Chrome\/([0-9.]+)/.exec(navigator.userAgent)[1].split(".")[0]>=30)this.$.typeSwitcher.addEventListener("mouseenter",function(){a.typeIndicatorMouseOver.apply(a,[])}),this.$.typeSwitcher.addEventListener("mouseleave",function(){a.typeIndicatorMouseLeave.apply(a,[])});else{var b=!1;this.$.typeSwitcher.addEventListener("mouseover",function(c){c.preventDefault(),c.stopPropagation(),b||(b=!0,a.typeIndicatorMouseOver.apply(a,[]))}),document.body.addEventListener("mouseover",function(){b&&(b=!1,a.typeIndicatorMouseLeave.apply(a,[]))})}}},a.openMenu=function(){window.app.editCRM.build({setItems:this.item.path,superquick:!0})},a.selectThisNode=function(){var a=this.$.checkbox.checked;this.$.checkbox.checked=!a,0===document.getElementsByClassName("highlighted").length&&this.classList.add("firstHighlighted"),a?this.onDeselect():this.onSelect()},a.openEditPage=function(){if(!this.shadow&&!window.app.item)if(this.classList.contains("selecting"))this.selectThisNode();else{var a=this.item;window.app.item=a,"script"===a.type?(window.app.stylesheetItem={},window.app.scriptItem=a):"stylesheet"===a.type?(window.app.scriptItem={},window.app.stylesheetItem=a):(window.app.stylesheetItem={},window.app.scriptItem={}),window.crmEditPage.init()}},a.getNextNode=function(a){if(a.children)return a.children[0];for(var b=Array.prototype.slice.apply(a.path),c=window.app.crm.lookup(b,!0),d=b.splice(b.length-1,1)[0];c.length-1<=d;)c=window.app.crm.lookup(b,!0),d=b.splice(b.length-1,1)[0];return c[d+1]},a.getPreviousNode=function(a){var b=Array.prototype.slice.apply(a.path),c=window.app.crm.lookup(b,!0),d=b.splice(b.length-1,1)[0];if(0===d){var e=window.app.crm.lookup(b);return e}var f=c[d-1];return f.children?f.children[f.children.length-1]:f},a.getNodesOrder=function(a,b){var c,d=a.path,e=b.path;if(d.length===e.length){var f=!0;for(c=0;c<d.length;c++)if(d[c]!==e[c]){f=!1;break}if(f)return"same"}var g=d.length>e.length?d.length:e.length;for(c=0;c<g;c++){if(void 0===e[c]||void 0===d[c])return void 0!==e[c]?"after":"before";if(e[c]>d[c])return"after";if(e[c]<d[c])return"before"}return"same"},a.generateShiftSelectionCallback=function(a,b){return function(){window.setTimeout(function(){window.app.editCRM.getCRMElementFromPath(a.path).onSelect(!0)},b)}},a.selectFromXToThis=function(){var a=this,b=document.getElementsByClassName("firstHighlighted")[0],c=b.item;$(".highlighted").each(function(){this.classList.remove("highlighted")});var d=this.getNodesOrder(c,this.item);if("same"===d)this.classList.add("highlighted"),this.$.checkbox.checked=!0,window.app.editCRM.selectedElements=[this.item.id];else{b.classList.add("highlighted"),b.$.checkbox.checked=!0,window.app.editCRM.selectedElements=[b.item.id];for(var e=0,f="after"===d?this.getNextNode:this.getPreviousNode,g=f(c);g.id!==this.item.id;)this.generateShiftSelectionCallback(g,e)(),e+=35,g=f(g);window.setTimeout(function(){a.classList.add("highlighted"),a.$.checkbox.checked=!0,window.app.editCRM.selectedElements.push(a.item.id)},e)}},a.checkClickType=function(a){a.detail.sourceEvent.ctrlKey?(window.app.editCRM.cancelAdding(),window.app.editCRM.selectItems(),this.selectThisNode()):this.classList.contains("selecting")&&a.detail.sourceEvent.shiftKey?this.selectFromXToThis():(window.app.editCRM.cancelAdding(),this.openEditPage())},a.calculateType=function(){this.type=this.item.type,(this.isScript="script"===this.item.type)&&(this.isLink=this.isMenu=this.isDivider=this.isStylesheet=!1)||(this.isLink="link"===this.item.type)&&(this.isMenu=this.isDivider=this.isStylesheet=!1)||(this.isStylesheet="stylesheet"===this.item.type)&&(this.isMenu=this.isDivider=!1)||(this.isMenu="menu"===this.item.type)&&(this.isDivider=!1)||(this.isDivider=!0),this.isCode=this.isScript||this.isStylesheet},a.typeIndicatorMouseOver=function(){var a=this;if(!this.shadow){var b=Date.now();this.lastTypeSwitchMouseover=b,this.async(function(){a.lastTypeSwitchMouseover===b&&(a.lastTypeSwitchMouseover=null,a.animationEl=a.animationEl||a.$$("type-switcher").$$(".TSContainer"),a.typeIndicatorAnimation&&a.typeIndicatorAnimation.play()||(a.typeIndicatorAnimation=a.animationEl.animate([{marginLeft:"-193px"},{marginLeft:0}],{duration:300,fill:"both",easing:"cubic-bezier(0.215, 0.610, 0.355, 1.000)"})))},25)}},a.animateOut=function(){this.typeIndicatorAnimation&&this.typeIndicatorAnimation.reverse()},a.typeIndicatorMouseLeave=function(){var a=this;if(this.lastTypeSwitchMouseover=null,!this.shadow){var b=this.$.typeSwitcher;b.toggledOpen?b.closeTypeSwitchContainer(!0,function(){b.toggledOpen=!1,b.$.typeSwitchChoicesContainer.style.display="none",b.$.typeSwitchArrow.style.transform="rotate(180deg)",a.animateOut()}):this.animateOut()}},a._getOnSelectFunction=function(a,b){return function(){window.app.editCRM.getCRMElementFromPath(a.item.children[b].path).onSelect(!0)}},a.onSelect=function(a,b){if(void 0===a&&(a=!1),void 0===b&&(b=!1),this.classList.add("highlighted"),a&&(this.$.checkbox.checked=!0),this.item.children&&!b)for(var c=0;c<this.item.children.length;c++)setTimeout(this._getOnSelectFunction(this,c),35*c),window.app.editCRM.selectedElements.push(this.item.children[c].id)},a._getOnDeselectFunction=function(a,b){return function(){window.app.editCRM.getCRMElementFromPath(a.item.children[b].path).onDeselect(!0)}},a.onDeselect=function(a,b){if(void 0===a&&(a=!1),void 0===b&&(b=!1),this.classList.remove("highlighted"),a&&(this.$.checkbox.checked=!1),this.item.children&&!b)for(var c=window.app.editCRM.selectedElements,d=0;d<this.item.children.length;d++)setTimeout(this._getOnDeselectFunction(this,d),35*d),c.splice(c.indexOf(this.item.children[d].id),1)},a.onToggle=function(){var a=this;setTimeout(function(){a.$.checkbox.checked?a.onSelect():a.onDeselect()},0)},a}();ECI.is="edit-crm-item",ECI.type="",ECI.isLink=!1,ECI.isScript=!1,ECI.isStylesheet=!1,ECI.isDivider=!1,ECI.properties=editCrmItemProperties,ECI.animationEl=null,ECI.typeIndicatorAnimation=null,ECI.lastTypeSwitchMouseover=null,Polymer(ECI);