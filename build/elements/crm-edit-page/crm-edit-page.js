/*
 * Original can be found at https://github.com/SanderRonde/CustomRightClickMenu 
 * This code may only be used under the MIT style license found in the LICENSE.txt file 
**/
"use strict";var crmEditPageProperties={animationConfig:{value:function(){return{entry:{name:"scale-up-animation",node:this.$.overlayCont,duration:300},exit:{name:"scale-down-animation",node:this.$.overlayCont,duration:300}}}},item:{type:Object,value:null,notify:!0},nodeInfo:{type:Object,value:{},notify:!0},hideUpdateMessage:{type:Boolean,value:!0,notify:!0}},CEP=function(){function a(){}return a.isLocal=function(a){return!a||("local"===a||this.item.isLocal)},a.nodeInfoExists=function(a){return!!a},a.hideNodeInfo=function(a){return!this.nodeInfoExists(a)||this.isLocal(a.source)&&!this.hasInstallDate(a)},a.hasInstallDate=function(a){return this.nodeInfoExists(a)&&!!a.installDate},a._onNeonAnimationFinish=function(){this.opened||(this.$overlayEl[0].style.display="none",this.$.overlayCont.style.display="none",document.body.style.overflow="auto",document.body.style.marginRight="0",window.app.show=!1,this.opened=!1,window.app.item=null,this.unassignItems())},a.unassignItems=function(){this.isLink=this.isScript=this.isStylesheet=this.isMenu=this.isDivider=!1,this.linkItem=this.scriptItem=this.stylesheetItem=this.menuItem=this.dividerItem={}},a.animateIn=function(){this.$overlayEl.css("display","block"),this.overlayAnimation&&this.overlayAnimation.play()||(this.overlayAnimation=this.$overlayEl[0].animate([{opacity:0},{opacity:.3}],{duration:300,fill:"both",easing:"cubic-bezier(0.215, 0.610, 0.355, 1.000)"})),document.body.style.overflow="hidden",document.body.style.marginRight="17px",window.app.show=!0,this.opened=!0,this.$.overlayCont.style.display="block",this.playAnimation("entry")},a.animateOut=function(){this.overlayAnimation.reverse(),this.$overlayEl.off("click"),this.playAnimation("exit"),this.opened=!1,document.body.parentElement.style.overflow="auto"},a.updateNodeInfo=function(a,b){void 0===b&&(b="nodeInfo");for(var c in a)a.hasOwnProperty(c)&&("object"==typeof a[c]&&this.updateNodeInfo(a[c],b+"."+c),this.notifyPath(b+"."+c,a[c]))},a.updateName=function(a){this.notifyPath("item.name",a)},a.showUpgradeNotice=function(a,b){return!a&&b&&"script"===b.type&&b.value&&b.value.updateNotice},a.getScriptUpdateStatus=function(a){return a?window.app.storageLocal.upgradeErrors&&window.app.storageLocal.upgradeErrors[a.id]?"Some errors have occurred in updating this script. Please resolve them by clicking the link and replace any chrome calls on error lines with their CRM API equivalent.":"No errors have been detected in updating this script but this is no guarantee it will work, be sure to test it at least once.":""},a.hideUpdateMergeDialog=function(){var a=this;if(this.showUpgradeNotice(this.hideUpdateMessage,this.item)){var b=this.$.scriptUpdateNotice.getBoundingClientRect().height,c="-"+b+"px";this.$.scriptUpdateNotice.animate([{marginBottom:"0px"},{marginBottom:c}],{duration:350,easing:"cubic-bezier(0.215, 0.610, 0.355, 1.000)"}).onfinish=function(){a.$.scriptUpdateNotice.style.marginBottom=c,a.hideUpdateMessage=!0}}window.scriptEdit.newSettings.value.updateNotice=!1},a.showScriptUpdateDiff=function(){var a=this,b=this.item.value.oldScript,c=this.item.value.script,d=window.doc.externalEditorChooseFile;d.init(b,c,function(b){window.app.storageLocal.upgradeErrors&&delete window.app.storageLocal.upgradeErrors[a.item.id],window.scriptEdit.editor.setValue(b),setTimeout(function(){a.hideUpdateMergeDialog()},250),chrome.storage.local.set({upgradeErrors:window.app.storageLocal.upgradeErrors||{}})},!0,window.app.storageLocal.upgradeErrors&&window.app.storageLocal.upgradeErrors[this.item.id]),window.externalEditor.showMergeDialog(window.externalEditor,b,c),d.open()},a.getInstallDateTextFormat=function(){if(window.Intl&&"object"==typeof window.Intl&&this.nodeInfo){var a="1-13-2016"===new Date("1-13-2016").toLocaleDateString()?"eu":"na",b=void 0;return"eu"===a?(b=this.nodeInfo.installDate.split("-"),b=b[1]+"-"+b[0]+"-"+b[2]):b=this.nodeInfo.installDate,b=new Date(b),Math.floor(new Date(Date.now()-b.getMilliseconds()).getMilliseconds()/864e5)+" days ago"}return null},a.ready=function(){var a=this;$(".popupCont").click(function(a){a.stopPropagation()}),this.$overlayEl=$(".overlayCont"),window.crmEditPage=this,this.isLink=this.isMenu=this.isScript=this.isDivider=!1,this.$.nodeInfoVersion.addEventListener("input",function(){a.item.nodeInfo.version=a.$.nodeInfoVersion.innerText.length>0?a.$.nodeInfoVersion.innerText:"1.0"})},a.init=function(){var a=this,b={isScript:!1,isLink:!1,isDivider:!1,isMenu:!1,isStylesheet:!1};this.hideUpdateMessage=!1,this.scriptItem=this.linkItem=this.dividerItem=this.menuItem=this.stylesheetItem={};var c=this.item;(b.isScript="script"===c.type)?(this.scriptItem=c,b.isLink=b.isMenu=b.isDivider=b.isStylesheet=!1):(b.isLink="link"===c.type)?(this.linkItem=c,b.isMenu=b.isDivider=b.isStylesheet=!1):(b.isStylesheet="stylesheet"===c.type)?(this.stylesheetItem=c,b.isMenu=b.isDivider=!1):(b.isMenu="menu"===c.type)?(this.menuItem=c,b.isDivider=!1):(b.isDivider=!0,this.dividerItem=c),setTimeout(function(){window.app.show=!0,a.isScript=b.isScript,a.isLink=b.isLink,a.isMenu=b.isMenu,a.isDivider=b.isDivider,a.isStylesheet=b.isStylesheet;var c=$(a).find("#editPageCont > :not([hidden])")[0];c.init.apply(c),a.animateIn()},300)},a}();CEP.is="crm-edit-page",CEP.behaviors=[Polymer.NeonAnimationRunnerBehavior],CEP.isLink=!1,CEP.isScript=!1,CEP.isDivider=!1,CEP.isMenu=!1,CEP.isStylesheet=!1,CEP.linkItem={},CEP.scriptItem={},CEP.dividerItem={},CEP.menuItem={},CEP.stylesheetItem={},CEP.opened=!1,CEP.overlayAnimation=null,CEP.properties=crmEditPageProperties,CEP.listeners={"neon-animation-finish":"_onNeonAnimationFinish"},Polymer(CEP);