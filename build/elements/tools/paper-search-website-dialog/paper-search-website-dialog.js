/*
 * Original can be found at https://github.com/SanderRonde/CustomRightClickMenu 
 * This code may only be used under the MIT style license found in the LICENSE.txt file 
**/
"use strict";var paperSearchWebsiteDialogProperties={selectedOption:{type:String,value:"url",notify:!0},selectedIsUrl:{type:Boolean,computed:"isSelectedUrl(selectedOption)",notify:!0},searchList:{type:Array,value:[],notify:!0},chosenUrl:{type:String,value:"",notify:!0},searchQuery:{type:String,value:"",notify:!0},searchTestResult:{type:String,value:"",computed:"getQueryResult(searchQuery, chosenUrl)",notify:!0},disableManualButton:{type:Boolean,value:!1,notify:!0}},PSWD=function(){function a(){}return a.getQueryResult=function(a,b){return b.replace(/%s/g,a)},a.isSelectedUrl=function(a){return"url"===a},a.hideAllWindows=function(a){var b=this;this.windows.forEach(function(c){c!==a&&(b.$[c].style.display="none")})},a.goBackWindow=function(){var a=this.windows[this.windowPath[this.windowPath.length-2]];this.windowPath.pop(),this.hideAllWindows(a),this.$[a].style.display="block",this.fit()},a.switchToWindow=function(a){this.hideAllWindows(a),"successWindow"===a?(this.$.successWindow.setAttribute("style","display:block;"),this.insertCode()):this.$[a].style.display="block",this.windowPath.push(this.windows.indexOf(a)),this.fit()},a.switchWindow=function(a){var b=window.app.util.findElementWithTagname(a.path,"paper-button");this.switchToWindow(b.getAttribute("window"))},a.loadWindow=function(a,b){var c=this,d=$(this).find("paper-spinner")[0];d.active=!0,this.hideAllWindows("loadingWindow"),this.$.loadingWindow.style.display="block",this.fit(),b.apply(this)(function(){c.$.manualInputListChoiceInput.invalid=!1,c.switchToWindow(a),d.active=!1},function(){c.$.manualInputListChoiceInput.invalid=!0,d.active=!1,c.switchToWindow("manuallyInputSearchWebsiteWindow")})},a.insertCode=function(){var a=this,b="var search = crmAPI.getSelection() || prompt('Please enter a search query');\nvar url = '"+this.chosenUrl+"';\nvar toOpen = url.replace(/%s/g,search);\n"+("currentTab"===this.$.howToOpenLink.selected?"location.href = toOpen;":"window.open(toOpen, '_blank');");window.scriptEdit.insertSnippet(window.scriptEdit,b,!0),setTimeout(function(){a.hide(),a.switchToWindow("initialWindow")},2500)},a.backFromManualInput=function(){this.$.manualInputListChoiceInput.value="",this.goBackWindow()},a.processSearchEngines=function(){var a=this;return function(b,c){var d=a.$.manualInputListChoiceInput.querySelector("textarea").value;try{var e=JSON.parse(d);$(".SEImportError").remove(),0!==e.length?(a.disableManualButton=!0,a.searchList=e,b("success")):c("data was invalid")}catch(a){c("data was invalid")}}},a.processManualInput=function(){this.selectedIsUrl?(this.chosenUrl=this.$.manualInputURLInput.querySelector("input").value.replace(/custom( )?[rR]ight( )?(-)?[cC]lick( )?[mM]enu/g,"%s"),this.switchToWindow("confirmationWindow")):this.loadWindow("processedListWindow",this.processSearchEngines)},a.applyDefaultsUrls=function(a){switch(this.$.searchWebsitesRadioGroup.selected){case"google":this.chosenUrl="https://www.google.com/search?q=%s";break;case"wikipedia":this.chosenUrl="http://en.wikipedia.org/w/index.php?title=Special:Search&search=%s";break;case"amazon":this.chosenUrl="http://www.amazon.com/s/?field-keywords=%s";break;case"youtube":this.chosenUrl="https://www.youtube.com/results?search_query=%s"}this.switchWindow(a)},a.confirmManualSearchListInput=function(){this.chosenUrl=$(this.$.listInputSearchList).find("paper-radio-button[checked]")[0].url,this.switchToWindow("confirmationWindow")},a.cancelAllRadiobuttons=function(a){$(this.$.listInputSearchList).find("paper-radio-button[checked]")[0].checked=!1;for(var b=a.target;"PAPER-RADIO-BUTTON"!==b.tagName;)b=b.parentElement;b.checked=!0,this.disableManualButton=!1},a.confirmInitialChoice=function(){"defaults"===this.$.initialWindowChoicesCont.selected?this.switchToWindow("chooseDefaultSearchWindow"):this.switchToWindow("manuallyInputSearchWebsiteWindow")},a.clear=function(){this.$.initialWindowChoicesCont.selected="defaults",this.switchToWindow("initialWindow"),this.searchList=[]},a.ready=function(){this.$.paperSearchWebsiteDialog.addEventListener("iron-overlay-closed ",this.clear)},a.init=function(){this.clear(),this.fit()},a.opened=function(){return this.$.paperSearchWebsiteDialog.opened},a.toggle=function(){this.$.paperSearchWebsiteDialog.toggle()},a.show=function(){this.$.paperSearchWebsiteDialog.open()},a.hide=function(){this.$.paperSearchWebsiteDialog.close()},a.fixFit=function(){var a=$(this.$.manualInputListChoiceInput).find("paper-input-container")[0];a.style.height="200px",this.fit(),a.style.height="auto",this.fitted=!1},a.fixOnChange=function(){this.fitted||(this.fit(),this.fitted=!0)},a.fit=function(){this.$.paperSearchWebsiteDialog.fit()},a}();PSWD.is="paper-search-website-dialog",PSWD.windowPath=[0],PSWD.fitted=!0,PSWD.windows=["initialWindow","chooseDefaultSearchWindow","manuallyInputSearchWebsiteWindow","processedListWindow","confirmationWindow","howToOpenWindow","successWindow","loadingWindow"],PSWD.properties=paperSearchWebsiteDialogProperties,Polymer(PSWD);