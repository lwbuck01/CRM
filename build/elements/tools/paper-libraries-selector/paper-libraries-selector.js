/*
 * Original can be found at https://github.com/SanderRonde/CustomRightClickMenu 
 * This code may only be used under the MIT style license found in the LICENSE.txt file 
**/
"use strict";var paperLibrariesSelectorProperties={usedlibraries:{type:Array,notify:!0},libraries:{type:Array,notify:!0},selected:{type:Array,notify:!0},installedLibraries:{type:Array},mode:{type:String,value:"main"}},PLS=function(){function a(){}return a.ready=function(){var a=this;window.paperLibrariesSelector=this,chrome.storage.local.get("libraries",function(b){b.libraries?a.installedLibraries=b.libraries:(a.installedLibraries=[],chrome.storage.local.set({libaries:a.installedLibraries}))}),chrome.storage.onChanged.addListener(function(b,c){"local"===c&&b.libraries&&(a.installedLibraries=b.libraries.newValue)})},a.sortByName=function(a,b){return a.name[0].toLowerCase().charCodeAt(0)-b.name[0].toLowerCase().charCodeAt(0)},a.categorizeLibraries=function(){var a=[],b={};return this.usedlibraries.forEach(function(c){null===c.name?a.push(c):b[c.name.toLowerCase()]=!0}),{anonymous:a,selectedObj:b}},a.getLibraries=function(a){var b=[];return this.installedLibraries.forEach(function(c){var d={};d.name=c.name,d.isLibrary=!0,d.url=c.url,a[c.name.toLowerCase()]?(d.classes="library iron-selected",d.selected="true"):(d.classes="library",d.selected="false"),b.push(d)}),b.sort(this.sortByName),b},a.setSelectedLibraries=function(a){var b=[];a.forEach(function(a,c){"true"===a.selected&&b.push(c)}),this.selected=b},a.init=function(){var a=this;this._expanded&&this.close();var b=this.categorizeLibraries(),c=b.anonymous,d=b.selectedObj,e=this.getLibraries(d);this.setSelectedLibraries(e);var f=[];c.forEach(function(a){var b={isLibrary:!0,name:a.url+" (anonymous)",classes:"library iron-selected anonymous",selected:"true"};f.push(b)}),f.sort(this.sortByName),e=e.concat(f),e.push({name:"Add your own",classes:"library addLibrary",selected:"false",isLibrary:!1}),a.libraries=e},a.resetAfterAddDesision=function(){window.doc.addLibraryConfirmAddition.removeEventListener("click"),window.doc.addLibraryDenyConfirmation.removeEventListener("click"),window.doc.addLibraryUrlInput.removeAttribute("invalid")},a.confirmLibraryFile=function(a,b,c,d){window.doc.addLibraryProcessContainer.style.display="none",window.doc.addLibraryLoadingDialog.style.display="flex",setTimeout(function(){window.doc.addLibraryConfirmationInput.value=c,window.doc.addLibraryConfirmAddition.addEventListener("click",function(){window.doc.addLibraryConfirmationInput.value="",a.addLibraryFile(a,b,c,d),a.resetAfterAddDesision()}),window.doc.addLibraryDenyConfirmation.addEventListener("click",function(){window.doc.addLibraryConfirmationContainer.style.display="none",window.doc.addLibraryProcessContainer.style.display="block",a.resetAfterAddDesision(),window.doc.addLibraryConfirmationInput.value=""}),window.doc.addLibraryLoadingDialog.style.display="none",window.doc.addLibraryConfirmationContainer.style.display="block"},250)},a.addLibraryToState=function(a,b,c,d){a.installedLibraries.push({name:b,code:c,url:d}),a.usedlibraries.push({name:b,url:d})},a.hideElements=function(){for(var a=[],b=0;b<arguments.length;b++)a[b]=arguments[b];for(var c=0;c<a.length;c++)window.doc[a[c]].style.display="none"},a.showElements=function(){for(var a=[],b=0;b<arguments.length;b++)a[b]=arguments[b];for(var c=0;c<a.length;c++)window.doc[a[c]].style.display="block"},a.addLibraryFile=function(a,b,c,d){void 0===d&&(d=null),window.doc.addLibraryConfirmationContainer.style.display="none",window.doc.addLibraryLoadingDialog.style.display="flex",setTimeout(function(){a.addLibraryToState(a,b,c,d),chrome.storage.local.set({libraries:a.installedLibraries}),"main"===a.mode&&null!==d&&window.scriptEdit.editor.addMetaTags(window.scriptEdit.editor,"require",d),chrome.runtime.sendMessage({type:"updateStorage",data:{type:"libraries",libraries:a.installedLibraries}}),a.splice("libraries",a.libraries.length-1,0,{name:b,classes:"library iron-selected",selected:"true",isLibrary:"true"});var e=$(a).find(".content");e.animate({height:e[0].scrollHeight},{duration:250,easing:"easeInCubic"}),a.hideElements("addLibraryLoadingDialog","addLibraryConfirmationContainer","addLibraryProcessContainer","addLibraryDialogSuccesCheckmark"),a.showElements("addLibraryDialogSucces"),$(window.doc.addLibraryDialogSucces).animate({backgroundColor:"rgb(38,153,244)"},{duration:300,easing:"easeOutCubic",complete:function(){a.showElements("addLibraryDialogSuccesCheckmark"),window.doc.addLibraryDialogSuccesCheckmark.classList.add("animateIn"),setTimeout(function(){window.doc.addLibraryDialog.toggle(),a.hideElements("addLibraryDialogSucces"),a.showElements("addLibraryLoadingDialog")},2500)}});var f=a.$$("paper-menu").querySelector(".content");f.style.height+=~~f.style.height.split("px")[0]+48+"px",a.init()},250)},a.addNewLibrary=function(){var a=this;window.doc.addedLibraryName.querySelector("input").value="",window.doc.addLibraryUrlInput.querySelector("input").value="",window.doc.addLibraryManualInput.querySelector("textarea").value="",this.showElements("addLibraryProcessContainer"),this.hideElements("addLibraryLoadingDialog","addLibraryConfirmationContainer","addLibraryDialogSucces"),window.doc.addedLibraryName.invalid=!1,window.doc.addLibraryDialog.open(),$(window.doc.addLibraryDialog).find("#addLibraryButton").on("click",function(){for(var b=window.doc.addedLibraryName.querySelector("input").value,c=!1,d=0;d<a.installedLibraries.length;d++)a.installedLibraries[d].name===b&&(c=!0);if(""===b||c)c?window.doc.addedLibraryName.errorMessage="That name is already taken":window.doc.addedLibraryName.errorMessage="Please enter a name",window.doc.addedLibraryName.invalid=!0;else if(a.removeAttribute("invalid"),"url"===window.doc.addLibraryRadios.selected){var e=window.doc.addLibraryUrlInput,f=e.querySelector("input").value;"/"===f[0]&&"/"===f[1]&&(f="http:"+f),$.ajax({url:f,dataType:"html"}).done(function(c){a.confirmLibraryFile(a,b,c,f)}).fail(function(){e.setAttribute("invalid","true")})}else a.addLibraryFile(a,b,window.doc.addLibraryManualInput.querySelector("textarea").value)})},a.addAnonymousLibrary=function(a){var b=a.target.getAttribute("data-url");"main"===this.mode&&window.scriptEdit.editor.removeMetaTags(window.scriptEdit.editor,"require",b),chrome.runtime.sendMessage({type:"anonymousLibrary",data:{type:"remove",name:b,url:b,scriptId:window.app.scriptItem.id}})},a.handleCheckmarkClick=function(a){var b=a.target.dataLib,c=a.target.classList.contains("iron-selected")?"removeMetaTags":"addMetaTags";if(b.url&&window.scriptEdit.editor[c](window.scriptEdit.editor,"require",b.url),"addMetaTags"===c)window.scriptEdit.newSettings.value.libraries.push({name:b.name||null,url:b.url});else{for(var d=-1,e=0;e<window.scriptEdit.newSettings.value.libraries.length;e++)if(window.scriptEdit.newSettings.value.libraries[e].url===b.url&&window.scriptEdit.newSettings.value.libraries[e].name===b.name){d=e;break}window.scriptEdit.newSettings.value.libraries.splice(d,1)}},a._click=function(a){var b=this;a.target.classList.contains("addLibrary")?this.addNewLibrary():a.target.classList.contains("anonymous")?this.addAnonymousLibrary(a):"main"===b.mode&&this.handleCheckmarkClick(a)},a.updateLibraries=function(a,b){void 0===b&&(b="main"),this.set("usedlibraries",a),this.mode=b,this.init()},a}();PLS.is="paper-libraries-selector",PLS.properties=paperLibrariesSelectorProperties,PLS.behaviors=[Polymer.PaperDropdownBehavior],Polymer(PLS);