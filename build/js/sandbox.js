!function(){function log(a,b){self.postMessage({type:"log",data:JSON.stringify(a),lineNo:b})}function verifyKey(a){return a===handshakeData.secretKey.join("")+handshakeData.id+"verified"}self.log=function(){var a=Array.prototype.slice.apply(arguments),b=(new Error).stack.split("\n")[2];b.indexOf("eval")>-1&&(b=(new Error).stack.split("\n")[3]);var c=b.split("at");log(a,c.slice(1,c.length).join("at"))},self.logNoStack=function(){log(Array.prototype.slice.apply(arguments))},self.console={log:self.log},self.onerror=function(a,b,c,d,e){self.log(e.name+" occurred in background page",message,e.stack),e.preventDefault()};var handshakeData=null,handshake=function(a,b,c){return handshakeData={id:a,secretKey:b,handler:c},self.postMessage({type:"handshake",data:JSON.stringify({id:a,key:b,tabId:0}),key:b}),{postMessage:function(a){self.postMessage({type:"crmapi",data:JSON.stringify(a),key:b})}}},returnHandshake=function(){return handshake};Object.defineProperty(self,"handshake",{get:returnHandshake}),self.addEventListener("message",function(e){var data=e.data;switch(data.type){case"init":var loadedLibraries=!0;if(function(){self;data.libraries.forEach(function(a){try{importScripts(a)}catch(b){loadedLibraries=!1,self.logNoStack([b.name," occurred in loading library ",a.split(/(\/|\\)/).pop(),"\n","Message: "].join(""),b.message,".\nStack:",b.stack)}})}(),returnHandshake=function(){return null},!loadedLibraries)return;console.log("Loaded libraries, launching script"),function(script,log){try{eval(["(function(window) {",script,"}(typeof window === 'undefined' ? self : window));"].join(""))}catch(a){self.logNoStack([a.name," occurred in executing background script","\n","Message: "].join(""),a.message,".\nStack:",a.stack)}log("Succesfully launched sript")}(data.script,self.log);break;case"verifiy":case"message":verifyKey(data.key)&&handshakeData.handler(JSON.parse(data.message))}})}();