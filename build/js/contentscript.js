!function(){function a(a){var b=document.createElement("script");b.innerHTML=a,document.documentElement.appendChild(b),document.documentElement.removeChild(b)}function b(a,b){var c=new XMLHttpRequest;c.open("GET",a),c.onreadystatechange=function(){4===c.readyState&&(200===c.status?b(c.responseText):console.warn("Failed to run script because the CRM API could not be found"))},c.send()}function c(c){var d=chrome.runtime.getURL("/js/crmapi.js");b(d,function(b){a(b),c()})}function d(c,e){if(c.length>e)if(c[e].code)a(c[e].code),d(c,e+1);else{var f=c[e].file;0!==f.indexOf("http")&&(f=chrome.runtime.getURL(f)),b(f,function(b){a(b),d(c,e+1)})}}function e(a){d(a,0)}var f=!1,g=["clientX","clientY","offsetX"," offsetY","pageX","pageY","screenX","screenY","which","x","y"],h=null,i=1,j=!1;chrome.runtime.onMessage.addListener(function(a,b,d){switch(a.type){case"checkTabStatus":d({notMatchedYet:!f}),a.data.willBeMatched&&(f=!0);break;case"getLastClickInfo":var k={};for(var l in h)g.indexOf(l)!==-1&&(k[l]=h[l]);h.srcElement.classList.add("crm_element_identifier_"+ ++i),k.srcElement=i,h.target.classList.add("crm_element_identifier_"+ ++i),k.target=i,h.toElement.classList.add("crm_element_identifier_"+ ++i),k.toElement=i,d(k);break;case"runScript":j?e(a.data.scripts):(c(function(){e(a.data.scripts)}),j=!0)}}),chrome.runtime.sendMessage({type:"newTabCreated"},function(a){a&&a.matched&&(f=!0)}),chrome.storage.local.get("useAsUserscriptInstaller",function(a){if(a.useAsUserscriptInstaller){var b=chrome.runtime.getURL("html/install.html");document.body.addEventListener("mousedown",function(a){var c=a.target;if(c&&c.href&&c.href.indexOf(b)===-1&&c.href.match(/.+user\.js$/)){var d=b+"?i="+encodeURIComponent(c.href)+"&s="+encodeURIComponent(location.href);c.href=d,c.target="_blank"}})}}),document.addEventListener("contextmenu",function(a){h=a})}();